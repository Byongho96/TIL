{"componentChunkName":"component---src-templates-post-index-tsx","path":"/posts/Django/08_Django_Many_to_Many.md/","result":{"data":{"markdownRemark":{"id":"67bbe6fe-fa2d-5504-8ec0-573007b2fe98","html":"<ul>\n<li><a href=\"#1-intro\">1. Intro</a>\n<ul>\n<li><a href=\"#11-terms\">1.1. Terms</a></li>\n<li><a href=\"#12-the-limits-of-n1-relationship\">1.2. The limits of N:1 Relationship</a></li>\n<li><a href=\"#13-intermediary-model\">1.3. Intermediary Model</a></li>\n<li><a href=\"#14-many-to-many-field\">1.4. Many To Many Field</a></li>\n<li><a href=\"#15-many-to-many-table\">1.5. Many To Many Table</a></li>\n<li><a href=\"#16-with-extra-fields\">1.6. with Extra Fields</a></li>\n</ul>\n</li>\n<li><a href=\"#2-like-article-user\">2. Like (Article-User)</a></li>\n<li><a href=\"#3-follow-user-user\">3. Follow (User-User)</a>\n<ul>\n<li><a href=\"#31-profile-page\">3.1. Profile Page</a></li>\n<li><a href=\"#32-follow\">3.2. Follow</a></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1 id=\"1-intro\" style=\"position:relative;\"><a href=\"#1-intro\" aria-label=\"1 intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Intro</h1>\n<h2 id=\"11-terms\" style=\"position:relative;\"><a href=\"#11-terms\" aria-label=\"11 terms permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.1. Terms</h2>\n<ul>\n<li><strong>Source Model</strong>\n<ul>\n<li>The model that has ManyToManyField</li>\n</ul>\n</li>\n<li><strong>Target model</strong>\n<ul>\n<li>The model that doesn't have ManyToManyField</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"12-the-limits-of-n1-relationship\" style=\"position:relative;\"><a href=\"#12-the-limits-of-n1-relationship\" aria-label=\"12 the limits of n1 relationship permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.2. The limits of N:1 Relationship</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Doctor</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Patient</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    doctor <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Doctor<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>modles<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">)</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>If one patient make reservations with 2 diffrent doctors, you can't distingush whether the first Alex and the second Alex is the same person.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">id</th>\n<th align=\"center\">name</th>\n<th align=\"center\">doctor_id</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">Alex</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">Alex</td>\n<td align=\"center\">2</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"13-intermediary-model\" style=\"position:relative;\"><a href=\"#13-intermediary-model\" aria-label=\"13 intermediary model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.3. Intermediary Model</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Doctor</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Patient</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    doctor <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Doctor<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>modles<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">)</span>\r\n    patient <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Patient<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>modles<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><strong>Create</strong>\n<ul>\n<li><code class=\"language-text\">Reservation.objects.create(doctor=doctor_instance, patient=patient_instance)</code></li>\n</ul>\n</li>\n<li><strong>Read</strong>\n<ul>\n<li>if doctor1 wants to read all the reservation\n<ul>\n<li><code class=\"language-text\">doctor1.reservaton_set.all()</code></li>\n</ul>\n</li>\n<li>if patient1 wants to read all the reservation\n<ul>\n<li><code class=\"language-text\">patinet1.reservaton_set.all()</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"14-many-to-many-field\" style=\"position:relative;\"><a href=\"#14-many-to-many-field\" aria-label=\"14 many to many field permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.4. Many To Many Field</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Doctor</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Patient</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    doctors <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ManyToManyField<span class=\"token punctuation\">(</span>Doctor<span class=\"token punctuation\">)</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p><strong>MantoToManyField(to, **options)</strong></p>\n<ul>\n<li><strong>to</strong>\n<ul>\n<li>the target model</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>options</strong>\n<ul>\n<li><strong>related_name</strong>\n<ul>\n<li>The alias of the dereference manager.</li>\n<li>Default value is <code class=\"language-text\">modelName_set</code></li>\n</ul>\n</li>\n<li><strong>through</strong>\n<ul>\n<li><a href=\"#16-manytomanyfield-with-extra-fields\">Desginate an intermediary table</a></li>\n</ul>\n</li>\n<li><strong>symmetrical</strong>\n<ul>\n<li>Default: True</li>\n<li>This argument is valid, only when <code class=\"language-text\">to = 'self'</code></li>\n<li>When it's True, the record for the opposite direction is automatically added.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Create</strong>\n<ul>\n<li><code class=\"language-text\">patient1.doctors.add(doctor1)</code></li>\n<li><code class=\"language-text\">doctor1.patient_set.add(patient1)</code></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Read</strong>\n<ul>\n<li>if doctor1 wants to read all the reservation\n<ul>\n<li><code class=\"language-text\">doctor1.patient_set.all()</code></li>\n<li><code class=\"language-text\">doctor1.patient_set.get(id=doctor_id)</code></li>\n</ul>\n</li>\n<li>if patient1 wants to read all the reservation\n<ul>\n<li><code class=\"language-text\">patient1.doctors.all()</code></li>\n<li><code class=\"language-text\">doctor1.patient_set.get(id=patient_id)</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Delete</strong>\n<ul>\n<li>if doctor1 wants to cancel the reservation with patient1\n<ul>\n<li><code class=\"language-text\">doctor1.patient_set.remove(patient1)</code></li>\n</ul>\n</li>\n<li>if patient1 wants to cancel the reservation with doctor1\n<ul>\n<li><code class=\"language-text\">patient1.doctors.remove(doctor1)</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"15-many-to-many-table\" style=\"position:relative;\"><a href=\"#15-many-to-many-table\" aria-label=\"15 many to many table permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.5. Many To Many Table</h2>\n<ul>\n<li><strong>Table Name</strong>\n<ul>\n<li>Default: <code class=\"language-text\">AppName_ModelName_FieldName</code></li>\n<li><code class=\"language-text\">db_table</code>\n<ul>\n<li>the argument for changing the table name</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Field name</strong>\n<ul>\n<li>source model != target model\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>SourceModel_id</th>\n<th>TargetModel_id</th>\n</tr>\n</thead>\n</table>\n</li>\n<li>source model == target model (<code class=\"language-text\">to = 'self'</code>)\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>form_ModelName_id</th>\n<th>to_ModelName_id</th>\n</tr>\n</thead>\n</table>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"16-with-extra-fields\" style=\"position:relative;\"><a href=\"#16-with-extra-fields\" aria-label=\"16 with extra fields permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.6. with Extra Fields</h2>\n<p><strong>Make an intermediary model</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Doctor</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Patient</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    doctors <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ManyToManyField<span class=\"token punctuation\">(</span>Doctor<span class=\"token punctuation\">,</span> related_name<span class=\"token operator\">=</span><span class=\"token string\">'patients'</span><span class=\"token punctuation\">,</span> through<span class=\"token operator\">=</span><span class=\"token string\">'Reservation'</span><span class=\"token punctuation\">)</span>\r\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    doctor <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Doctor<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>modles<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">)</span>\r\n    patient <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Patient<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>modles<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">)</span>\r\n    symptom <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    reserved_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><strong>Create</strong>\n<ul>\n<li>through Reservation Model\n<ul>\n<li><code class=\"language-text\">Reservation.objects.create(doctor=doctor1, patient=patient1, symptom='stomachache')</code></li>\n</ul>\n</li>\n<li>through ManyToMany Field\n<ul>\n<li><code class=\"language-text\">patient1.doctors.add(doctor1, through_defaults={'symptom': 'flu'})</code></li>\n<li>through_defaults can be defined as a function</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"2-like-article-user\" style=\"position:relative;\"><a href=\"#2-like-article-user\" aria-label=\"2 like article user permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Like (Article-User)</h1>\n<ul>\n<li>\n<p><strong>models.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Article</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    user <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>setttings<span class=\"token punctuation\">.</span>AUTH_USER_MODEL<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">)</span>\r\n    like_users <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ManyToManyField<span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">.</span>AUTH_USER_MODEL<span class=\"token punctuation\">,</span> related_name<span class=\"token operator\">=</span>like_articles<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><strong>relate_name should be specified</strong><br>\nOtherwise, in the upper case, the dereference manager name(user.article_set) would be duplicated.</li>\n</ul>\n</li>\n<li>\n<p><strong>forms.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ArticleForm</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>ModelForm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n\r\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\r\n        model <span class=\"token operator\">=</span> Article\r\n        exclude <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'like_users'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p><strong>urls.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">app_name <span class=\"token operator\">=</span> <span class=\"token string\">'articles'</span><span class=\"token punctuation\">,</span>\r\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\r\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;int:article_pk>/likes/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>likes<span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">'likes'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@require_POST</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">likes</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> article_pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\r\n        article <span class=\"token operator\">=</span> Article<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>pk<span class=\"token operator\">=</span>article_pk<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">if</span> article<span class=\"token punctuation\">.</span>like_usres<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>pk<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>exists<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token comment\"># if request.user in article.like_users.all():</span>\r\n        <span class=\"token comment\"># get을 쓰면 객체가 없을 때 Error 발생</span>\r\n            article<span class=\"token punctuation\">.</span>like_users<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\r\n            article<span class=\"token punctuation\">.</span>like_users<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span><span class=\"token string\">'articles:index'</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span><span class=\"token string\">'accounts:login'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><strong>exists()</strong><br>\nReturns True if the QuerySet has value, or False</li>\n</ul>\n</li>\n<li>\n<p><strong>index.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{% block content %} {% for article in articles %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>b</span><span class=\"token punctuation\">></span></span>작성자 : {{ article.user }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>b</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>글 번호: {{ article.pk }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>글 제목: {{ article.title }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>글 내용: {{ article.content }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{% url 'article:likes' article.pk %}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\r\n    {% csrf_token %} {% if request.user in article.like_users.all %}\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>좋아요취소<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\r\n    {% else %}\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>좋아요<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\r\n    {% endif %}\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{% url 'articles:detail' article.pk %}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>DETAIL<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span> <span class=\"token punctuation\">/></span></span>\r\n{% endfor %} {% endblock content %}</code></pre></div>\n</li>\n</ul>\n<h1 id=\"3-follow-user-user\" style=\"position:relative;\"><a href=\"#3-follow-user-user\" aria-label=\"3 follow user user permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Follow (User-User)</h1>\n<h2 id=\"31-profile-page\" style=\"position:relative;\"><a href=\"#31-profile-page\" aria-label=\"31 profile page permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1. Profile Page</h2>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">app_name<span class=\"token operator\">=</span><span class=\"token string\">'accounts'</span>\r\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\r\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'profile/&lt;str:username>/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>profile<span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">'profile'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>if you name the path as <code class=\"language-text\">path('&lt;str:username>/', views.profile, name='profile')</code>, you should consider the order of the url paths carefully.</li>\n</ul>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib<span class=\"token punctuation\">.</span>auth <span class=\"token keyword\">import</span> get_user_model\r\n\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">profile</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    User <span class=\"token operator\">=</span> get_user_model<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    person <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">)</span>\r\n    context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string\">'person'</span><span class=\"token punctuation\">:</span> person<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> render<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token string\">'accounts/prfile.html'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p><strong>profile.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{% block content %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>{{ person.username }}'s profile<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\r\n\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span><span class=\"token punctuation\">></span></span>{{ person.username }}'s articles<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span>\r\n{% for article in person.article_set.all %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>{{ article.title }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\r\n{% endfor %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span> <span class=\"token punctuation\">/></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span><span class=\"token punctuation\">></span></span>{{ person.username }}'s comments<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span>\r\n{% for comment in person.comment_set.all %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>{{ comment.content }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\r\n{% endfor %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span> <span class=\"token punctuation\">/></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span><span class=\"token punctuation\">></span></span>{{ person.username }}'s liked articles<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span>\r\n{% for article in person.like_articles.all %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>{{ article.title }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\r\n{% endfor %} {% endblock content %}</code></pre></div>\n</li>\n<li>\n<p><strong>base.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{% url 'accounts:profile' user.username %}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>My Profile<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n<li>\n<p><strong>index.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{% block content %} {% for article in articles %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>b</span>\r\n    <span class=\"token punctuation\">></span></span>작성자 :\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{% url 'accounts:profile' article.user.username %}<span class=\"token punctuation\">\"</span></span>\r\n      <span class=\"token punctuation\">></span></span>{{ article.user }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span>\r\n    <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>b</span>\r\n  <span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>글 번호: {{ article.pk }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>글 제목: {{ article.title }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>글 내용: {{ article.content }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{% url 'articles:detail' article.pk %}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>DETAIL<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span> <span class=\"token punctuation\">/></span></span>\r\n{% endfor %} {% endblock content %}</code></pre></div>\n</li>\n</ul>\n<h2 id=\"32-follow\" style=\"position:relative;\"><a href=\"#32-follow\" aria-label=\"32 follow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2. Follow</h2>\n<ul>\n<li><strong>models.py</strong>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>AbstractUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    followings <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ManyToManyField<span class=\"token punctuation\">(</span><span class=\"token string\">'self'</span><span class=\"token punctuation\">,</span> symmetrical<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> related_name<span class=\"token operator\">=</span><span class=\"token string\">'followers'</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li><strong>urls.py</strong>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">app_name <span class=\"token operator\">=</span> <span class=\"token string\">'accounts'</span><span class=\"token punctuation\">,</span>\r\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\r\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;int:user_pk>/follow/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>follow<span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">'follow'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li><strong>views.py</strong>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@require_POST</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">follow</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> user_pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>pk <span class=\"token operator\">!=</span> user_pk<span class=\"token punctuation\">:</span>\r\n            User <span class=\"token operator\">=</span> get_user_model<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n            person <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>pk<span class=\"token operator\">=</span>user_pk<span class=\"token punctuation\">)</span>\r\n            <span class=\"token keyword\">if</span> person<span class=\"token punctuation\">.</span>followers<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>pk<span class=\"token operator\">=</span>reqeust<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>exists<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token comment\"># if reuqest.user in person.followers.all():</span>\r\n                person<span class=\"token punctuation\">.</span>followers<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\r\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\r\n                person<span class=\"token punctuation\">.</span>followers<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span><span class=\"token string\">'accounts:profile'</span> person<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span><span class=\"token string\">'accounts:login'</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li><strong>profile.html</strong>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{% block content %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>{{ person.username }}'s profile<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\r\n  Followers: {{ person.followers.all|length }} Followings:{{\r\n  erson.followings.all|length }}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\r\n{% if request.user != person %}\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{% url 'accounts:follow' person.pk %}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\r\n    {% csrf_token %} {% if request.user in person.followers.all %} &lt;input\r\n    type=\"submit\" value==\"Follow\"> {% else %} &lt;input type=\"submit\"\r\n    value==\"Unfollow\"> {% endif %}\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\r\n... {% endblock content %}</code></pre></div>\n</li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#1-intro\">1. Intro</a></p>\n<ul>\n<li><a href=\"#11-terms\">1.1. Terms</a></li>\n<li><a href=\"#12-the-limits-of-n1-relationship\">1.2. The limits of N:1 Relationship</a></li>\n<li><a href=\"#13-intermediary-model\">1.3. Intermediary Model</a></li>\n<li><a href=\"#14-many-to-many-field\">1.4. Many To Many Field</a></li>\n<li><a href=\"#15-many-to-many-table\">1.5. Many To Many Table</a></li>\n<li><a href=\"#16-with-extra-fields\">1.6. with Extra Fields</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-like-article-user\">2. Like (Article-User)</a></p>\n</li>\n<li>\n<p><a href=\"#3-follow-user-user\">3. Follow (User-User)</a></p>\n<ul>\n<li><a href=\"#31-profile-page\">3.1. Profile Page</a></li>\n<li><a href=\"#32-follow\">3.2. Follow</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"createdAt":"2022-11-08","isCompleted":true,"reference":null,"title":"Django N:M Realationship","updatedAt":"2022-12-27"}}},"pageContext":{"pagePath":"posts/Django/08_Django_Many_to_Many.md","id":"67bbe6fe-fa2d-5504-8ec0-573007b2fe98","parent":{"id":"67e5455f-99b7-58a9-ac4b-f85ae34df124","name":"08_Django_Many_to_Many","relativeDirectory":"Django","relativePath":"Django/08_Django_Many_to_Many.md"}}},"staticQueryHashes":["3300660363","3571427910","82772122"],"slicesMap":{}}