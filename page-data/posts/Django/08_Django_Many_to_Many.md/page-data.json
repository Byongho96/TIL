{"componentChunkName":"component---src-templates-post-index-tsx","path":"/posts/Django/08_Django_Many_to_Many.md/","result":{"data":{"markdownRemark":{"id":"633d2abf-abb7-5325-92c0-54dbe1989fa6","html":"<ul>\n<li><a href=\"#1-intro\">1. Intro</a>\n<ul>\n<li><a href=\"#11-terms\">1.1. Terms</a></li>\n<li><a href=\"#12-the-limits-of-n1-relationship\">1.2. The limits of N:1 Relationship</a></li>\n<li><a href=\"#13-intermediary-model\">1.3. Intermediary Model</a></li>\n<li><a href=\"#14-many-to-many-field\">1.4. Many To Many Field</a></li>\n<li><a href=\"#15-many-to-many-table\">1.5. Many To Many Table</a></li>\n<li><a href=\"#16-with-extra-fields\">1.6. with Extra Fields</a></li>\n</ul>\n</li>\n<li><a href=\"#2-like-article-user\">2. Like (Article-User)</a></li>\n<li><a href=\"#3-follow-user-user\">3. Follow (User-User)</a>\n<ul>\n<li><a href=\"#31-profile-page\">3.1. Profile Page</a></li>\n<li><a href=\"#32-follow\">3.2. Follow</a></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1 id=\"1-intro\" style=\"position:relative;\"><a href=\"#1-intro\" aria-label=\"1 intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Intro</h1>\n<h2 id=\"11-terms\" style=\"position:relative;\"><a href=\"#11-terms\" aria-label=\"11 terms permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.1. Terms</h2>\n<ul>\n<li><strong>Source Model</strong>\n<ul>\n<li>The model that has ManyToManyField</li>\n</ul>\n</li>\n<li><strong>Target model</strong>\n<ul>\n<li>The model that doesn't have ManyToManyField</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"12-the-limits-of-n1-relationship\" style=\"position:relative;\"><a href=\"#12-the-limits-of-n1-relationship\" aria-label=\"12 the limits of n1 relationship permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.2. The limits of N:1 Relationship</h2>\n<pre><code class=\"language-python\">class Doctor(models.Model):\n    name = models.TextField()\n\nclass Patient(models.Model):\n    doctor = models.ForeignKey(Doctor, on_delete=modles.CASCADE)\n    name = models.TextField()\n</code></pre>\n<p>If one patient make reservations with 2 diffrent doctors, you can't distingush whether the first Alex and the second Alex is the same person.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">id</th>\n<th align=\"center\">name</th>\n<th align=\"center\">doctor_id</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">Alex</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">Alex</td>\n<td align=\"center\">2</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"13-intermediary-model\" style=\"position:relative;\"><a href=\"#13-intermediary-model\" aria-label=\"13 intermediary model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.3. Intermediary Model</h2>\n<pre><code class=\"language-python\">class Doctor(models.Model):\n    name = models.TextField()\n\nclass Patient(models.Model):\n    name = models.TextField()\n\nclass Reservation(models.Model):\n    doctor = models.ForeignKey(Doctor, on_delete=modles.CASCADE)\n    patient = models.ForeignKey(Patient, on_delete=modles.CASCADE)\n</code></pre>\n<ul>\n<li><strong>Create</strong>\n<ul>\n<li><code>Reservation.objects.create(doctor=doctor_instance, patient=patient_instance)</code></li>\n</ul>\n</li>\n<li><strong>Read</strong>\n<ul>\n<li>if doctor1 wants to read all the reservation\n<ul>\n<li><code>doctor1.reservaton_set.all()</code></li>\n</ul>\n</li>\n<li>if patient1 wants to read all the reservation\n<ul>\n<li><code>patinet1.reservaton_set.all()</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"14-many-to-many-field\" style=\"position:relative;\"><a href=\"#14-many-to-many-field\" aria-label=\"14 many to many field permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.4. Many To Many Field</h2>\n<pre><code class=\"language-python\">class Doctor(models.Model):\n    name = models.TextField()\n\nclass Patient(models.Model):\n    doctors = models.ManyToManyField(Doctor)\n    name = models.TextField()\n</code></pre>\n<ul>\n<li>\n<p><strong>MantoToManyField(to, **options)</strong></p>\n<ul>\n<li><strong>to</strong>\n<ul>\n<li>the target model</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>options</strong>\n<ul>\n<li><strong>related_name</strong>\n<ul>\n<li>The alias of the dereference manager.</li>\n<li>Default value is <code>modelName_set</code></li>\n</ul>\n</li>\n<li><strong>through</strong>\n<ul>\n<li><a href=\"#16-manytomanyfield-with-extra-fields\">Desginate an intermediary table</a></li>\n</ul>\n</li>\n<li><strong>symmetrical</strong>\n<ul>\n<li>Default: True</li>\n<li>This argument is valid, only when <code>to = 'self'</code></li>\n<li>When it's True, the record for the opposite direction is automatically added.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Create</strong>\n<ul>\n<li><code>patient1.doctors.add(doctor1)</code></li>\n<li><code>doctor1.patient_set.add(patient1)</code></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>Read</strong>\n<ul>\n<li>if doctor1 wants to read all the reservation\n<ul>\n<li><code>doctor1.patient_set.all()</code></li>\n<li><code>doctor1.patient_set.get(id=doctor_id)</code></li>\n</ul>\n</li>\n<li>if patient1 wants to read all the reservation\n<ul>\n<li><code>patient1.doctors.all()</code></li>\n<li><code>doctor1.patient_set.get(id=patient_id)</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Delete</strong>\n<ul>\n<li>if doctor1 wants to cancel the reservation with patient1\n<ul>\n<li><code>doctor1.patient_set.remove(patient1)</code></li>\n</ul>\n</li>\n<li>if patient1 wants to cancel the reservation with doctor1\n<ul>\n<li><code>patient1.doctors.remove(doctor1)</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"15-many-to-many-table\" style=\"position:relative;\"><a href=\"#15-many-to-many-table\" aria-label=\"15 many to many table permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.5. Many To Many Table</h2>\n<ul>\n<li><strong>Table Name</strong>\n<ul>\n<li>Default: <code>AppName_ModelName_FieldName</code></li>\n<li><code>db_table</code>\n<ul>\n<li>the argument for changing the table name</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Field name</strong>\n<ul>\n<li>source model != target model\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>SourceModel_id</th>\n<th>TargetModel_id</th>\n</tr>\n</thead>\n</table>\n</li>\n<li>source model == target model (<code>to = 'self'</code>)\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>form_ModelName_id</th>\n<th>to_ModelName_id</th>\n</tr>\n</thead>\n</table>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"16-with-extra-fields\" style=\"position:relative;\"><a href=\"#16-with-extra-fields\" aria-label=\"16 with extra fields permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.6. with Extra Fields</h2>\n<p><strong>Make an intermediary model</strong></p>\n<pre><code class=\"language-python\">class Doctor(models.Model):\n    name = models.TextField()\n\nclass Patient(models.Model):\n    doctors = models.ManyToManyField(Doctor, related_name='patients', through='Reservation')\n    name = models.TextField()\n\nclass Reservation(models.Model):\n    doctor = models.ForeignKey(Doctor, on_delete=modles.CASCADE)\n    patient = models.ForeignKey(Patient, on_delete=modles.CASCADE)\n    symptom = models.TextField()\n    reserved_at = models.DateTimeField(auto_now_add=True)\n</code></pre>\n<ul>\n<li><strong>Create</strong>\n<ul>\n<li>through Reservation Model\n<ul>\n<li><code>Reservation.objects.create(doctor=doctor1, patient=patient1, symptom='stomachache')</code></li>\n</ul>\n</li>\n<li>through ManyToMany Field\n<ul>\n<li><code>patient1.doctors.add(doctor1, through_defaults={'symptom': 'flu'})</code></li>\n<li>through_defaults can be defined as a function</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"2-like-article-user\" style=\"position:relative;\"><a href=\"#2-like-article-user\" aria-label=\"2 like article user permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Like (Article-User)</h1>\n<ul>\n<li>\n<p><strong>models.py</strong></p>\n<pre><code class=\"language-python\">class Article(models.Model):\n    user = models.ForeignKey(setttings.AUTH_USER_MODEL, on_delete=models.CASCADE)\n    like_users = models.ManyToManyField(settings.AUTH_USER_MODEL, related_name=like_articles)\n</code></pre>\n<ul>\n<li><strong>relate_name should be specified</strong><br>\nOtherwise, in the upper case, the dereference manager name(user.article_set) would be duplicated.</li>\n</ul>\n</li>\n<li>\n<p><strong>forms.py</strong></p>\n<pre><code class=\"language-python\">class ArticleForm(models.ModelForm):\n\n    class Meta:\n        model = Article\n        exclude = ('user', 'like_users', )\n</code></pre>\n</li>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\">app_name = 'articles',\nurlpatterns = [\n    ...,\n    path('&#x3C;int:article_pk>/likes/', views.likes, name='likes')\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">@require_POST\ndef likes(request, article_pk):\n    if request.user.is_authenticated:\n        article = Article.objects.get(pk=article_pk)\n        if article.like_usres.filter(pk=request.user.pk).exists():\n        # if request.user in article.like_users.all():\n        # get을 쓰면 객체가 없을 때 Error 발생\n            article.like_users.remove(request.user)\n        else:\n            article.like_users.add(request.user)\n        return redirect('articles:index')\n    return redirect('accounts:login')\n</code></pre>\n<ul>\n<li><strong>exists()</strong><br>\nReturns True if the QuerySet has value, or False</li>\n</ul>\n</li>\n<li>\n<p><strong>index.html</strong></p>\n<pre><code class=\"language-html\">{% block content %} {% for article in articles %}\n&#x3C;p>&#x3C;b>작성자 : {{ article.user }}&#x3C;/b>&#x3C;/p>\n&#x3C;p>글 번호: {{ article.pk }}&#x3C;/p>\n&#x3C;p>글 제목: {{ article.title }}&#x3C;/p>\n&#x3C;p>글 내용: {{ article.content }}&#x3C;/p>\n&#x3C;div>\n  &#x3C;form action=\"{% url 'article:likes' article.pk %}\" method=\"POST\">\n    {% csrf_token %} {% if request.user in article.like_users.all %}\n    &#x3C;input type=\"submit\" value=\"좋아요취소\" />\n    {% else %}\n    &#x3C;input type=\"submit\" value=\"좋아요\" />\n    {% endif %}\n  &#x3C;/form>\n&#x3C;/div>\n&#x3C;a href=\"{% url 'articles:detail' article.pk %}\">DETAIL&#x3C;/a>\n&#x3C;hr />\n{% endfor %} {% endblock content %}\n</code></pre>\n</li>\n</ul>\n<h1 id=\"3-follow-user-user\" style=\"position:relative;\"><a href=\"#3-follow-user-user\" aria-label=\"3 follow user user permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Follow (User-User)</h1>\n<h2 id=\"31-profile-page\" style=\"position:relative;\"><a href=\"#31-profile-page\" aria-label=\"31 profile page permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1. Profile Page</h2>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\">app_name='accounts'\nurlpatterns = [\n    path('profile/&#x3C;str:username>/', views.profile, name='profile'),\n]\n</code></pre>\n<ul>\n<li>if you name the path as <code>path('&#x3C;str:username>/', views.profile, name='profile')</code>, you should consider the order of the url paths carefully.</li>\n</ul>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from django.contrib.auth import get_user_model\n\ndef profile(request, username):\n    User = get_user_model()\n    person = User.objects.get(username=username)\n    context = {\n        'person': person,\n    }\n    return render(request, 'accounts/prfile.html', context)\n</code></pre>\n</li>\n<li>\n<p><strong>profile.html</strong></p>\n<pre><code class=\"language-html\">{% block content %}\n&#x3C;h1>{{ person.username }}'s profile&#x3C;/h1>\n\n&#x3C;h4>{{ person.username }}'s articles&#x3C;/h4>\n{% for article in person.article_set.all %}\n&#x3C;div>{{ article.title }}&#x3C;/div>\n{% endfor %}\n&#x3C;hr />\n&#x3C;h4>{{ person.username }}'s comments&#x3C;/h4>\n{% for comment in person.comment_set.all %}\n&#x3C;div>{{ comment.content }}&#x3C;/div>\n{% endfor %}\n&#x3C;hr />\n&#x3C;h4>{{ person.username }}'s liked articles&#x3C;/h4>\n{% for article in person.like_articles.all %}\n&#x3C;div>{{ article.title }}&#x3C;/div>\n{% endfor %} {% endblock content %}\n</code></pre>\n</li>\n<li>\n<p><strong>base.html</strong></p>\n<pre><code class=\"language-html\">&#x3C;a href=\"{% url 'accounts:profile' user.username %}\">My Profile&#x3C;/a>\n</code></pre>\n</li>\n<li>\n<p><strong>index.html</strong></p>\n<pre><code class=\"language-html\">{% block content %} {% for article in articles %}\n&#x3C;p>\n  &#x3C;b\n    >작성자 :\n    &#x3C;a href=\"{% url 'accounts:profile' article.user.username %}\"\n      >{{ article.user }}&#x3C;/a\n    >&#x3C;/b\n  >\n&#x3C;/p>\n&#x3C;p>글 번호: {{ article.pk }}&#x3C;/p>\n&#x3C;p>글 제목: {{ article.title }}&#x3C;/p>\n&#x3C;p>글 내용: {{ article.content }}&#x3C;/p>\n&#x3C;a href=\"{% url 'articles:detail' article.pk %}\">DETAIL&#x3C;/a>\n&#x3C;hr />\n{% endfor %} {% endblock content %}\n</code></pre>\n</li>\n</ul>\n<h2 id=\"32-follow\" style=\"position:relative;\"><a href=\"#32-follow\" aria-label=\"32 follow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2. Follow</h2>\n<ul>\n<li><strong>models.py</strong>\n<pre><code class=\"language-python\">class User(AbstractUser):\n    followings = models.ManyToManyField('self', symmetrical=False, related_name='followers')\n</code></pre>\n</li>\n<li><strong>urls.py</strong>\n<pre><code class=\"language-python\">app_name = 'accounts',\nurlpatterns = [\n    ...,\n    path('&#x3C;int:user_pk>/follow/', views.follow, name='follow')\n]\n</code></pre>\n</li>\n<li><strong>views.py</strong>\n<pre><code class=\"language-python\">@require_POST\ndef follow(request, user_pk):\n    if request.user.is_authenticated:\n        if request.user.pk != user_pk:\n            User = get_user_model()\n            person = User.objects.get(pk=user_pk)\n            if person.followers.filter(pk=reqeust.user.pk).exists():\n            # if reuqest.user in person.followers.all():\n                person.followers.remove(request.user)\n            else:\n                person.followers.add(request.user)\n        return redirect('accounts:profile' person.username)\n    return redirect('accounts:login')\n</code></pre>\n</li>\n<li><strong>profile.html</strong>\n<pre><code class=\"language-html\">{% block content %}\n&#x3C;h1>{{ person.username }}'s profile&#x3C;/h1>\n&#x3C;div>\n  Followers: {{ person.followers.all|length }} Followings:{{\n  erson.followings.all|length }}\n&#x3C;/div>\n{% if request.user != person %}\n&#x3C;div>\n  &#x3C;form action=\"{% url 'accounts:follow' person.pk %}\" method=\"POST\">\n    {% csrf_token %} {% if request.user in person.followers.all %} &#x3C;input\n    type=\"submit\" value==\"Follow\"> {% else %} &#x3C;input type=\"submit\"\n    value==\"Unfollow\"> {% endif %}\n  &#x3C;/form>\n&#x3C;/div>\n... {% endblock content %}\n</code></pre>\n</li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#1-intro\">1. Intro</a></p>\n<ul>\n<li><a href=\"#11-terms\">1.1. Terms</a></li>\n<li><a href=\"#12-the-limits-of-n1-relationship\">1.2. The limits of N:1 Relationship</a></li>\n<li><a href=\"#13-intermediary-model\">1.3. Intermediary Model</a></li>\n<li><a href=\"#14-many-to-many-field\">1.4. Many To Many Field</a></li>\n<li><a href=\"#15-many-to-many-table\">1.5. Many To Many Table</a></li>\n<li><a href=\"#16-with-extra-fields\">1.6. with Extra Fields</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-like-article-user\">2. Like (Article-User)</a></p>\n</li>\n<li>\n<p><a href=\"#3-follow-user-user\">3. Follow (User-User)</a></p>\n<ul>\n<li><a href=\"#31-profile-page\">3.1. Profile Page</a></li>\n<li><a href=\"#32-follow\">3.2. Follow</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Django N:M Realationship","createdAt":"2022-11-08","updatedAt":"2022-12-27","tags":null,"description":null,"reference":null}},"allMarkdownRemark":{"nodes":[{"id":"005a8113-20da-59f5-849d-0f9aef3a6f71","parent":{"id":"84f76b0b-ed0c-5bab-a01c-527db65b0400","name":"02_Django_CRUD","relativePath":"Django/02_Django_CRUD.md"},"frontmatter":{"title":"Django Basic CRUD","createdAt":"2022-11-08","updatedAt":"2022-12-24"},"excerpt":"0. Cross Site Request Forgery(CSRF) 0.1. What is CSRF 0.2. CSRF Token 1. Model 1.1. models.py 2. Create 2.1. urls.py 2.2. views.py 2.…"},{"id":"0de70fd0-12aa-50df-9b48-f01e0a227eaf","parent":{"id":"b2c5f3de-6374-5e40-965e-581fad21ff28","name":"01_Django_Basics_MTV","relativePath":"Django/01_Django_Basics_MTV.md"},"frontmatter":{"title":"Django Basics & MTV Design Pattern","createdAt":"2022-12-24","updatedAt":"2022-12-24"},"excerpt":"1. Django 1.1. Framework 1.2. Django 2. MTV Design Pattern 2.1. Design Pattern 2.2. MTV Design Pattern 3. Start Django 4. Django Folder…"},{"id":"ade014fc-d912-54fa-8675-d122aa8f44ad","parent":{"id":"4fde6c73-3e67-5377-b04a-dc5180c6ec82","name":"03_Django_CRUD_ModelForm","relativePath":"Django/03_Django_CRUD_ModelForm.md"},"frontmatter":{"title":"Django CRUD with Model Form","createdAt":"2022-11-08","updatedAt":"2022-12-24"},"excerpt":"1. Model Form 1.1. Model Class 1.2. Form Class 1.3. ModeForm Class 2. Create 2.1. urls.py 2.2. views.py 2.3. templates.html 3. Read 3.…"},{"id":"397c0d91-4c7a-5ab6-8e32-c5d7386727ea","parent":{"id":"c267c5b8-dc49-5713-ad34-8b2c2ac02a49","name":"10_Django_Fixtures","relativePath":"Django/10_Django_Fixtures.md"},"frontmatter":{"title":"Django Fixtures","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"excerpt":"1. Fixtures 1.1. The Definition of Fixtures 1.2. The Default Path of Fixtures 1.3. Create Fixtures 1.4. Import Fixtures 1. Fixtures How to…"},{"id":"69420cc4-915c-5eb2-94aa-20d32c90a4b2","parent":{"id":"5154c6c2-58ed-5383-8571-bc8f9b666149","name":"04_Django_Authentication","relativePath":"Django/04_Django_Authentication.md"},"frontmatter":{"title":"Django Internal Authentication","createdAt":"2022-12-24","updatedAt":"2023-01-02"},"excerpt":"1. Overview 1.1. Authentication 1.2. Authorization 1.3. accounts App 2. Custom User Model 2.1. User Model 2.2. Custom User Model 2.3. User…"},{"id":"55874a3b-56f1-5093-a858-1586c85f9dc2","parent":{"id":"a84a604d-81a4-5ee7-9914-73ce3a3e7e74","name":"07_Django_Many_to_One","relativePath":"Django/07_Django_Many_to_One.md"},"frontmatter":{"title":"Django N:1 Realationship","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"excerpt":"1. Many to One Relationship 1.1. Foreign Key 2. Comment : Article (N:1) 2.1. Create 2.2. Read 2.3. Delete 3. Article : User (N:1) 3.…"},{"id":"633d2abf-abb7-5325-92c0-54dbe1989fa6","parent":{"id":"976f6368-b1b7-5f0c-8a32-e5cfb6056227","name":"08_Django_Many_to_Many","relativePath":"Django/08_Django_Many_to_Many.md"},"frontmatter":{"title":"Django N:M Realationship","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"excerpt":"1. Intro 1.1. Terms 1.2. The limits of N:1 Relationship 1.3. Intermediary Model 1.4. Many To Many Field 1.5. Many To Many Table 1.6. with…"},{"id":"f7ac871f-e347-59d7-8418-39557102d551","parent":{"id":"9f5cf10a-5b33-5d35-aa41-032787c3343b","name":"06_Django_QuerySet","relativePath":"Django/06_Django_QuerySet.md"},"frontmatter":{"title":"Django QuerySet","createdAt":"2022-12-24","updatedAt":"2022-12-25"},"excerpt":"1. QuerySet 1.1. Query 1.1. What is QuerySet 1.1.1. Check SQL Query 1.2. QuerySet API 1.3. QuerySet Evaluation and Caching 1.3.1. Evaluation…"},{"id":"b3d21f66-8f2b-59a8-81c4-587fe42f84f2","parent":{"id":"21cc89c1-794b-59d3-bb90-86f961c2bf51","name":"11_Django_REST_API","relativePath":"Django/11_Django_REST_API.md"},"frontmatter":{"title":"Django REST API","createdAt":"2022-11-08","updatedAt":"2022-12-28"},"excerpt":"1. HTTP 1.1. HTTP 정의 1.2. HTTP의 특징 1.3. HTTP Request Methods 1.3. HTTP Response Status Code 1.4. URI(Uniform Resource Indentifier) 1.5. URL…"},{"id":"255d6bb1-5984-5128-8fda-aa203cae6dcd","parent":{"id":"537a7f4b-d6af-50a5-9f04-a17b2eb274b5","name":"12_Django_REST_Authentication","relativePath":"Django/12_Django_REST_Authentication.md"},"frontmatter":{"title":"Django REST Authentication","createdAt":"2023-01-02","updatedAt":"2023-01-12"},"excerpt":"1. CORS 1.1. Same Origin Policy 1.2. Definition of Origin 1.3. CORS 1.3.1. django-cors-headers 2. Authentication 2.1. Authentication Class…"},{"id":"b1b31545-c67e-5d21-8254-dc52ed891c2b","parent":{"id":"e0689d95-499a-5f59-8d10-6132ecec9aef","name":"09_Django_Static_Media","relativePath":"Django/09_Django_Static_Media.md"},"frontmatter":{"title":"Django Static Files","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"excerpt":"1. Static Files 1.1. Static Files 1.2. Static Files with Django 1.3. Deploy Static Files 1.3.1. STATIC_ROOT 1.3.2. Procedure 2. Media Files…"},{"id":"b97171dd-b5cf-5451-9b77-2e7a7840bcb7","parent":{"id":"cf91fadb-f3c3-5472-bbe0-45bb09d06c47","name":"05_SQLite3_SQL","relativePath":"Django/05_SQLite3_SQL.md"},"frontmatter":{"title":"SQL Basics","createdAt":"2022-12-28","updatedAt":"2022-12-28"},"excerpt":"1. Database 1.1. RDB 1.2. Structure 2. SQL 2.1. SQL 2.2. Types of SQL Commands 2.3. SQL Syntax 2.4. Import .csv to Table 3. DDL 3.1. CREATE…"}]}},"pageContext":{"pagePath":"posts/Django/08_Django_Many_to_Many.md","regex":"/^(?!.*README).*Django.*$/","relativeDirectory":"Django","id":"633d2abf-abb7-5325-92c0-54dbe1989fa6","parent":{"id":"976f6368-b1b7-5f0c-8a32-e5cfb6056227","name":"08_Django_Many_to_Many","relativePath":"Django/08_Django_Many_to_Many.md"}}},"staticQueryHashes":["3300660363","3571427910"],"slicesMap":{}}