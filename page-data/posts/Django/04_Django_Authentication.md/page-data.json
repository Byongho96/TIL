{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/Django/04_Django_Authentication.md/","result":{"data":{"markdownRemark":{"id":"055ea80f-3d17-52c7-8851-463c43196083","html":"<h1>Django Authentication</h1>\n<h2>Index</h2>\n<ul>\n<li><a href=\"#1-overview\">1. Overview</a>\n<ul>\n<li><a href=\"#11-authentication\">1.1. Authentication</a></li>\n<li><a href=\"#12-authorization\">1.2. Authorization</a></li>\n<li><a href=\"#13-accounts-app\">1.3. accounts App</a></li>\n</ul>\n</li>\n<li><a href=\"#2-custom-user-model\">2. Custom User Model</a>\n<ul>\n<li><a href=\"#21-user-model\">2.1. User Model</a></li>\n<li><a href=\"#22-custom-user-model\">2.2. Custom User Model</a></li>\n<li><a href=\"#23-user-model-rendering\">2.3. User Model Rendering</a></li>\n</ul>\n</li>\n<li><a href=\"#3-session-authentication-with-cookie\">3. Session Authentication with Cookie</a>\n<ul>\n<li><a href=\"#31-session-table\">3.1. Session Table</a></li>\n<li><a href=\"#32-what-is-cookie\">3.2. What is Cookie</a></li>\n<li><a href=\"#33-sessionid-in-cookie\">3.3. Sessionid in Cookie</a></li>\n</ul>\n</li>\n<li><a href=\"#4-user-crud\">4 User CRUD</a>\n<ul>\n<li><a href=\"#41-create-sign-up\">4.1. Create (Sign Up)</a></li>\n<li><a href=\"#42-update\">4.2. Update</a>\n<ul>\n<li><a href=\"#421-user-information\">4.2.1. User Information</a></li>\n<li><a href=\"#422-password\">4.2.2. Password</a></li>\n</ul>\n</li>\n<li><a href=\"#43-delete-withdrawl\">4.3. Delete (Withdrawl)</a></li>\n</ul>\n</li>\n<li><a href=\"#5-session-crud\">5. Session CRUD</a>\n<ul>\n<li><a href=\"#51-create-login\">5.1. Create (Login)</a></li>\n<li><a href=\"#52-delete-logout\">5.2. Delete (Logout)</a></li>\n</ul>\n</li>\n<li><a href=\"#6-access-limitations\">6. Access Limitations</a>\n<ul>\n<li><a href=\"#61-view\">6.1. View</a></li>\n<li><a href=\"#62-template\">6.2. Template</a></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1>1. Overview</h1>\n<h2>1.1. Authentication</h2>\n<p>Authentication is the process of verifying who the user is</p>\n<h2>1.2. Authorization</h2>\n<p>Authorization is the process of verifying what specific applications, files, and data the user has access to</p>\n<h2>1.3. accounts App</h2>\n<p>Django strongly recommends that apps that manage User Model be named accounts</p>\n<hr>\n<h1>2. Custom User Model</h1>\n<h2>2.1. User Model</h2>\n<p><a href=\"https://docs.djangoproject.com/en/4.1/ref/contrib/auth/\">Django User Model 공식문서</a><br>\nBuilt-in model with authentication-related features in Django</p>\n<h2>2.2. Custom User Model</h2>\n<p><strong>Django strongly recommends developers to make a Custom User Model by inheriting AbstractUser.</strong> Otherwise, it becomes difficult to modify the User Model during development.</p>\n<ol>\n<li>\n<p><strong>Make a Custom User Model</strong></p>\n<pre><code class=\"language-python\"># accounts/models.py\r\nfrom djagno.contrib.auth.models import AbstarctUser\r\n\r\nclass User(AbstractUser):\r\n    pass\n</code></pre>\n</li>\n<li>\n<p><strong>Register the Model to the Setting</strong></p>\n<pre><code class=\"language-python\"># settings.py\r\n\r\n# the vairable 'AUTH_USER_MODEL' is announced in global_settings.py whih settings.py inherited\r\nAUTH_USER_MODEL = 'accounts.User'   # default = 'auth.User'\n</code></pre>\n</li>\n<li>\n<p><strong>Register the Model to the Admin Page</strong></p>\n<pre><code class=\"language-python\"># accounts/admin.py\r\nfrom .models import User\r\nfrom django.contirb.auth.admin import UserAdmin\r\n\r\n# It should be registered to the admin site as same as the other models\r\nadmin.site.register(User, UserAdmin)\n</code></pre>\n</li>\n</ol>\n<h2>2.3. User Model Rendering</h2>\n<p>Since the User model is registered in the template option, <strong>the user variable can be used in the django template</strong> without any additional procedures.</p>\n<ul>\n<li>\n<p>settings.py</p>\n<pre><code class=\"language-python\"># settings.py\r\n\r\nTEMPLATES = [\r\n  {\r\n    'BACKEND': 'django.template.backends.django.DjangoTemplates',\r\n    'DIRS': [BASE_DIR / 'templates',],\r\n    'APP_DIRS': True,\r\n    'OPTIONS': {\r\n        'context_processors': [\r\n            'django.template.context_processors.debug',\r\n            'django.template.context_processors.request',\r\n            'django.contrib.auth.context_processors.auth', # &#x3C;&#x3C;&#x3C; this one\r\n            'django.contrib.messages.context_processors.messages',\r\n        ],\r\n    },\r\n  },\r\n]\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>templates\n<pre><code class=\"language-html\">&#x3C;p>Hello, {{user}}&#x3C;/p>\n</code></pre>\nIf the user is not authenticated, it shows 'AnonymousUser'</li>\n</ul>\n<hr>\n<h1>3. Session Authentication with Cookie</h1>\n<h2>3.1. Session Table</h2>\n<p><a href=\"https://codingdog.tistory.com/entry/djangosession-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EC%96%B4-%EC%9E%88%EB%8A%94-%EC%84%B8%EC%85%98%EC%9D%80-%EC%96%B4%EB%96%A4-%EA%B0%92%EB%93%A4%EC%9D%84-%EA%B0%80%EC%A7%80%EA%B3%A0-%EC%9E%88%EC%9D%84%EA%B9%8C%EC%9A%94\">Django Session Data에 대한 블로그 글</a></p>\n<ul>\n<li><strong>Session key</strong> is a randomly issued string.</li>\n<li><strong>Session data</strong> is an encoded data of user.id, expired data, and etc.</li>\n</ul>\n<h2>3.2. What is Cookie</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/ff22489db0883b239319055529aafade/bf093/cookie.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 31%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAAB1pBqwWf/xAAXEAEBAQEAAAAAAAAAAAAAAAABAAMC/9oACAEBAAEFAgQuc9r/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwEn/8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAEDOh/9oACAEBAAY/Aiy61XZ//8QAGxAAAgEFAAAAAAAAAAAAAAAAAAERITFRYYH/2gAIAQEAAT8hvJ2LVOEJ5B//2gAMAwEAAgADAAAAEPwP/8QAFREBAQAAAAAAAAAAAAAAAAAAEQD/2gAIAQMBAT8QWL//xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCT/8QAGxAAAgIDAQAAAAAAAAAAAAAAAREAQSExUZH/2gAIAQEAAT8QfEVuV7qEGkI2kwo0QgtjZZ0+VP/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"HTTP_cookie\" title=\"\" src=\"/TIL/static/ff22489db0883b239319055529aafade/4b190/cookie.jpg\" srcset=\"/TIL/static/ff22489db0883b239319055529aafade/e07e9/cookie.jpg 200w,\n/TIL/static/ff22489db0883b239319055529aafade/066f9/cookie.jpg 400w,\n/TIL/static/ff22489db0883b239319055529aafade/4b190/cookie.jpg 800w,\n/TIL/static/ff22489db0883b239319055529aafade/bf093/cookie.jpg 888w\" sizes=\"(max-width: 800px) 100vw, 800px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Cookie s a small piece of data that works on a web service. It's <strong>issued by the server</strong>, and the <strong>browser stores cookies and automatically sends back</strong> whenever the user sends a request to the server.</p>\n<h2>3.3. Sessionid in Cookie</h2>\n<p><code>from django.contrib.auth import login</code></p>\n<ul>\n<li>Generate session_key and session_data, and save data in django.session table<br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/13a67365a72386e7f1973c4f7b77b42e/bfe25/django_session_table.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 9.499999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAACABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAcyAsD//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAEAAwAAAAAAAAAAAAAAAAABABAx/9oACAEBAAE/IWjJ/9oADAMBAAIAAwAAABBzz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABcQAQEBAQAAAAAAAAAAAAAAAAABMUH/2gAIAQEAAT8Q0qZw/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"session_table\" title=\"\" src=\"/TIL/static/13a67365a72386e7f1973c4f7b77b42e/4b190/django_session_table.jpg\" srcset=\"/TIL/static/13a67365a72386e7f1973c4f7b77b42e/e07e9/django_session_table.jpg 200w,\n/TIL/static/13a67365a72386e7f1973c4f7b77b42e/066f9/django_session_table.jpg 400w,\n/TIL/static/13a67365a72386e7f1973c4f7b77b42e/4b190/django_session_table.jpg 800w,\n/TIL/static/13a67365a72386e7f1973c4f7b77b42e/e5166/django_session_table.jpg 1200w,\n/TIL/static/13a67365a72386e7f1973c4f7b77b42e/bfe25/django_session_table.jpg 1422w\" sizes=\"(max-width: 800px) 100vw, 800px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></li>\n<li>Set session cookie {'sessionid':session_key}<br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/4cdf30e5fa1e4c893508e3eefabeb7ff/ad53c/sessionid_cookie.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3KAD/8QAFhABAQEAAAAAAAAAAAAAAAAAABEB/9oACAEBAAEFAsRH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhABAQEAAAAAAAAAAAAAAAAAABEB/9oACAEBAAE/IY1CH//aAAwDAQACAAMAAAAQg8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAACAgMAAAAAAAAAAAAAAAABEQAQMXGR/9oACAEBAAE/EEQVgTd2j//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"sessionid_cookie\" title=\"\" src=\"/TIL/static/4cdf30e5fa1e4c893508e3eefabeb7ff/4b190/sessionid_cookie.jpg\" srcset=\"/TIL/static/4cdf30e5fa1e4c893508e3eefabeb7ff/e07e9/sessionid_cookie.jpg 200w,\n/TIL/static/4cdf30e5fa1e4c893508e3eefabeb7ff/066f9/sessionid_cookie.jpg 400w,\n/TIL/static/4cdf30e5fa1e4c893508e3eefabeb7ff/4b190/sessionid_cookie.jpg 800w,\n/TIL/static/4cdf30e5fa1e4c893508e3eefabeb7ff/e5166/sessionid_cookie.jpg 1200w,\n/TIL/static/4cdf30e5fa1e4c893508e3eefabeb7ff/ad53c/sessionid_cookie.jpg 1241w\" sizes=\"(max-width: 800px) 100vw, 800px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></li>\n</ul>\n<hr>\n<h1>4 User CRUD</h1>\n<h2>4.1. Create (Sign Up)</h2>\n<ul>\n<li>\n<p><strong>forms.py</strong></p>\n<pre><code class=\"language-python\"># accounts/forms.py\r\nfrom django.contrib.auth import get_user_model\r\nfrom django.contrib.auth.forms import UserCreationForm\r\n\r\nclass CustomUserCreationFrom(UserCreationForm):\r\n\r\n    class Meta(UserCreationForm.Meta):\r\n        model = get_user_model()\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\"># accoutns/urls.py\r\n\r\napp_name =  'accounts'\r\nurlpatterns = [\r\n    path('signup/', views.signup, name='signup'),\r\n]\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from django.contrib.auth import login as auth_login\r\nfrom .forms import CustomUserCreationForm\r\n\r\ndef login(request):\r\n    if request.method  == 'POST':\r\n        form = CustomUserCreationFrom(request.POST)\r\n        if form.is_valid():\r\n            # 곧바로 회원가입\r\n            # save가 로그인 후 user을 반환\r\n            user = form.save()\r\n            auth_login(reqeust, user)\r\n            return redirect('articles:index')\r\n    else:\r\n        form = CustomUserCreationForm()\r\n    context = {\r\n        'form': form\r\n    }\r\n    return render(request, 'accounts/signup.html', context)\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>signup.html</strong></p>\n<pre><code class=\"language-django\">&#x3C;h1>Signup&#x3C;/h1>\r\n&#x3C;form action=\"{% url 'accounts:signup' %}\" method=\"POST\">\r\n    {% csrf_token %}\r\n    {{ form.as_p }}\r\n    &#x3C;input type=\"submit\">\r\n&#x3C;/form>\n</code></pre>\n</li>\n</ul>\n<h2>4.2. Update</h2>\n<h3>4.2.1. User Information</h3>\n<ul>\n<li>\n<p><strong>forms.py</strong></p>\n<pre><code class=\"language-python\">from django.contrib.auth import get_user_model\r\nfrom django.contrib.auth.forms import UserChangeForm\r\n\r\nclass CustomUserChangeForm(UserChangeForm):\r\n\r\n  class Meta(UserChangeForm.Meta):\r\n      model = get_user_model()\r\n      fields = ('email', 'first_name', 'last_name',)\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\"># accoutns/urls.py\r\n\r\napp_name =  'accounts'\r\nurlpatterns = [\r\n    path('update/', views.update, name='update'),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from .forms import CustomUserChangeForm\r\n\r\ndef update(request):\r\n    if request.method  == 'POST':\r\n        form = CustomUserChangeForm(request.POST, instance=request.user)\r\n        if form.is_valid():\r\n            form.save()\r\n            return redirect('articles:index')\r\n    else:\r\n        form = CustomUserChangeForm(instance=request.user)\r\n    context = {\r\n        'form': form\r\n    }\r\n    return render(request, 'accounts/update.html', context)\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>update.html</strong></p>\n<pre><code class=\"language-django\">&#x3C;h1>ChangeInfo&#x3C;/h1>\r\n&#x3C;form action=\"{% url 'accounts:update' %}\" method=\"POST\">\r\n    {% csrf_token %}\r\n    {{ form.as_p }}\r\n    &#x3C;input type=\"submit\">\r\n&#x3C;/form>\n</code></pre>\n</li>\n</ul>\n<h3>4.2.2. Password</h3>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\"># accoutns/urls.py\r\n\r\napp_name =  'accounts'\r\nurlpatterns = [\r\n    path('password/', views.chage_password, name='change_password'),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from django.contrib.auth.forms import PasswordChangeForm\r\nfrom django.contrib.auth import update_session_auth_hash\r\n\r\ndef update(request):\r\n    if request.method  == 'POST':\r\n        form = PasswrodChangeForm(request.user, request.POST)\r\n        if form.is_valid():\r\n            form.save()\r\n            # 비밀변경 후 변경 된 사용자 객체와 세션을 업데이트\r\n            update_session_auth_hash(request, form.user)\r\n            return redirect('articles:index')\r\n    else:\r\n        form = PasswordChangeForm(request.user)\r\n    context = {\r\n        'form': form\r\n    }\r\n    return render(request, 'accounts/change_password.html', context)\n</code></pre>\n</li>\n<li>\n<p><strong>change_password.html</strong></p>\n<pre><code class=\"language-django\">&#x3C;h1>Change Password&#x3C;/h1>\r\n&#x3C;form action=\"{% url 'accounts:change_password' %}\" method=\"POST\">\r\n    {% csrf_token %}\r\n    {{ form.as_p }}\r\n    &#x3C;input type=\"submit\">\r\n&#x3C;/form>\n</code></pre>\n</li>\n</ul>\n<h2>4.3. Delete (Withdrawl)</h2>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\"># accoutns/urls.py\r\n\r\napp_name =  'accounts'\r\nurlpatterns = [\r\n    path('delete/', views.delete, name='delete'),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">def delete(request):\r\n    # 탈퇴 후 로그아웃\r\n    # 로그아웃 후 탈퇴 시, 요청 객체 정보가 사라져서 탈퇴할 수 없음\r\n    request.user.delete()\r\n    auth_logout(request)\r\n    return redirect('articles:index')\n</code></pre>\n</li>\n</ul>\n<h1>5. Session CRUD</h1>\n<h2>5.1. Create (Login)</h2>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\"># accoutns/urls.py\r\n\r\napp_name =  'accounts'\r\nurlpatterns = [\r\n    path('login/', views.login, name='login'),\r\n]\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from django.contrib.auth.forms import AuthentifcationFrom\r\nfrom django.contrib.auth import login as auth_login\r\n\r\ndef login(request):\r\n    if request.method  == 'POST':\r\n        form = AuthentificationForm(request, request.POST)\r\n        # 쿠키를 보내기 위해서 request를 같이 넣어줌\r\n        if form.is_valid()\r\n            auth_login(request, form.get_user())\r\n            return redirect('articles:index')\r\n    else:\r\n        form = AuthentificationForm()\r\n    context = {\r\n        'form': form\r\n    }\r\n    return render(request, 'accounts/login.html', context)\n</code></pre>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>login.html</strong></p>\n<pre><code class=\"language-django\">  &#x3C;h1>Login&#x3C;/h1>\r\n  &#x3C;form action=\"{% url 'accounts:login' %}\" method=\"POST\">\r\n      {% csrf_token %}\r\n      {{ form.as_p }}\r\n      &#x3C;input type=\"submit\">\r\n  &#x3C;/form>\n</code></pre>\n</li>\n</ul>\n<h2>5.2. Delete (Logout)</h2>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\"># accoutns/urls.py\r\n\r\napp_name =  'accounts'\r\nurlpatterns = [\r\n    path('logout/', views.logout, name='logout'),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from django.contrib.auth import logout as auth_logout\r\n\r\ndef logout(request):\r\n    auth_logout(request)\r\n    return redirect('articles:index')\n</code></pre>\n</li>\n</ul>\n<hr>\n<h1>6. Access Limitations</h1>\n<h2>6.1. View</h2>\n<ul>\n<li>\n<p><strong>user.is_authenticated</strong></p>\n<pre><code class=\"language-python\"># articles.views.py\r\n# 로그인 된 사용자는 또다시 로그인 못하도록\r\ndef login(request):\r\n    if request.user.is_authenticated:\r\n        return redirect('articles:index')\n</code></pre>\n</li>\n<li>\n<p><strong>@login_required</strong></p>\n<ul>\n<li>\n<p>In the case of the '@login_required' decorator, the first address to be accessed is stored in the next query.</p>\n<pre><code class=\"language-python\"># articles.views.py\r\nfrom django.contrib.auth.decorators import login_required\r\n\r\n@login_required\r\n@request_http_methods(['GET', 'POST'])\r\ndef create(request):\r\n    pass\r\n\r\n# /accounts/create/로 강제 접속 시 해당 url이 next 쿼리로 저장\r\n# /accounts/login/?next=/accounts/create/\n</code></pre>\n<pre><code class=\"language-python\">def login(request):\r\nif request.user.is_authenticated:\r\n    return redirect('articles:index')\r\n\r\nif request.method == 'POST':\r\n    form = AuthenticationForm(request, request.POST)\r\n    if form.is_valid():\r\n        auth_login(request, form.get_user())\r\n        # next 쿼리가 있으면 바로 그곳으로 redirect 시킴, 없을 경우에는 index 페이지로\r\n        return redirect(request.GET.get('next') or 'articles:index')\r\nelse:\r\n    form = AuthenticationForm()\r\ncontext = {\r\n    'form': form,\r\n}\r\nreturn render(request, 'accounts/login.html', context)\n</code></pre>\n<pre><code class=\"language-html\">&#x3C;h1>Login&#x3C;/h1>\r\n&#x3C;!--\r\nnext쿼리를 유지시켜 주기 위해 요청 url 주소를 자기 자신으로 설정\r\n-->\r\n&#x3C;form action=\"\" method=\"POST\">\r\n  {% csrf_token %} {{ form.as_p }}\r\n  &#x3C;input type=\"submit\" />\r\n&#x3C;/form>\n</code></pre>\n</li>\n<li>\n<p>However, the next query is not available, if the function doesn't allow GET method.</p>\n<pre><code class=\"language-python\"># 아래를 위의 예시처럼 next쿼리를 다루더라도\r\n# GET으로 next쿼리를 처리하는 과정에서 @request_POST를 넘지 못함\r\n@login_required\r\n@request_POST\r\ndef delete(request):\r\n    article = Article.objects.get(pk=pk)\r\n    article.delete()\r\n    return redirect('articles:index')\n</code></pre>\n<pre><code class=\"language-python\">@request_POST\r\ndef delete(request):\r\n    if request.user.is_authenticated:\r\n        article = Article.objects.get(pk=pk)\r\n        article.delete()\r\n        return redirect('articles:index')\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h2>6.2. Template</h2>\n<ul>\n<li>\n<p><strong>user.is_authenticated</strong></p>\n<pre><code class=\"language-html\">&#x3C;div class=\"container\">\r\n  {% if request.user.is_authenticated %}\r\n  &#x3C;h3>{{ user }}&#x3C;/h3>\r\n  &#x3C;form action=\"{% url 'accounts:logout' %}\" method=\"POST\">\r\n    {% csrf_token %}\r\n    &#x3C;input type=\"submit\" value=\"Logout\" />\r\n  &#x3C;/form>\r\n  &#x3C;form action=\"{% url 'accounts:delete' %}\" method=\"POST\">\r\n    {% csrf_token %}\r\n    &#x3C;input type=\"submit\" value=\"회원탈퇴\" />\r\n  &#x3C;/form>\r\n  &#x3C;a href=\"{% url 'accounts:update' %}\">회원정보수정&#x3C;/a>\r\n  {% else %}\r\n  &#x3C;a href=\"{% url 'accounts:login' %}\">Login&#x3C;/a>\r\n  &#x3C;a href=\"{% url 'accounts:signup' %}\">Signup&#x3C;/a>\r\n  {% endif %}\r\n  &#x3C;hr />\r\n  {% block content %} {% endblock content %}\r\n&#x3C;/div>\r\n``\n</code></pre>\n</li>\n</ul>"}},"pageContext":{"pagePath":"posts/Django/04_Django_Authentication.md","id":"055ea80f-3d17-52c7-8851-463c43196083","parent":{"id":"b42a9fbf-382a-5675-8986-927671476c9c","name":"04_Django_Authentication","relativePath":"Django/04_Django_Authentication.md"}}},"staticQueryHashes":["1274812890","3935499650","82772122"],"slicesMap":{}}