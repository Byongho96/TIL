{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/Django/07_Django_Many_to_One.md/","result":{"data":{"markdownRemark":{"id":"f0d82e9d-bddf-53bb-807a-131e6603cd89","html":"<h1>Django Many To One Relationship</h1>\n<h2>Index</h2>\n<ul>\n<li><a href=\"#1-many-to-one-relationship\">1. Many-To-One Relationship</a>\n<ul>\n<li><a href=\"#11-foreign-key\">1.1. Foreign Key</a></li>\n</ul>\n</li>\n<li><a href=\"#2-comment--article-n1\">2. Comment : Article (N:1)</a>\n<ul>\n<li><a href=\"#21-create\">2.1. Create</a></li>\n<li><a href=\"#22-read\">2.2. Read</a></li>\n<li><a href=\"#23-delete\">2.3. Delete</a></li>\n</ul>\n</li>\n<li><a href=\"#3-article--user-n1\">3. Article : User (N:1)</a>\n<ul>\n<li><a href=\"#31-create\">3.1. Create</a></li>\n<li><a href=\"#32-update\">3.2. Update</a></li>\n<li><a href=\"#33-delete\">3.3. Delete</a></li>\n</ul>\n</li>\n<li><a href=\"#4-comment--user-n1\">4. Comment : User (N:1)</a>\n<ul>\n<li><a href=\"#41-create\">4.1. Create</a></li>\n<li><a href=\"#42-read\">4.2. Read</a></li>\n<li><a href=\"#43-delete\">4.3. Delete</a></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1>1. Many to One Relationship</h1>\n<p><strong>One-to-Many relationship in DBMS is a relationship between instances of an entity with more than one instance of another entity.</strong>\r\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/0002477094b511c0b801f4c5c0c066cc/15ae0/Many_to_one.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 18%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAG+gi0Hn//EABcQAQADAAAAAAAAAAAAAAAAAAACETL/2gAIAQEAAQUCRzT/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwFn/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BJ//EABYQAQEBAAAAAAAAAAAAAAAAAAAxAf/aAAgBAQAGPwJV1//EABoQAAICAwAAAAAAAAAAAAAAAAARAZEhMdH/2gAIAQEAAT8hcvc2NKNZh2P/2gAMAwEAAgADAAAAEPAv/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QAE//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBKz//EABoQAAMBAAMAAAAAAAAAAAAAAAERIQBBkdH/2gAIAQEAAT8QNFxy/uVI0liu8DBBOf/Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Many_to_one\" title=\"\" src=\"/TIL/static/0002477094b511c0b801f4c5c0c066cc/4b190/Many_to_one.jpg\" srcset=\"/TIL/static/0002477094b511c0b801f4c5c0c066cc/e07e9/Many_to_one.jpg 200w,\n/TIL/static/0002477094b511c0b801f4c5c0c066cc/066f9/Many_to_one.jpg 400w,\n/TIL/static/0002477094b511c0b801f4c5c0c066cc/4b190/Many_to_one.jpg 800w,\n/TIL/static/0002477094b511c0b801f4c5c0c066cc/15ae0/Many_to_one.jpg 1092w\" sizes=\"(max-width: 800px) 100vw, 800px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></p>\n<h2>1.1. Foreign Key</h2>\n<p>A foreign key is a column or columns of data in one table that refers to the unique data values (often the primary key data) in another table</p>\n<hr>\n<h1>2. Comment : Article (N:1)</h1>\n<ul>\n<li>\n<p><strong>models.py</strong></p>\n<pre><code class=\"language-python\"># articles/models.py\r\nclass Article(models.Model):\r\n    title = models.CharField(max_length=10)\r\n    content = models.TextField()\r\n    created_at = models.DateTimeField(auto_now_add=True)\r\n    updated_at = models.DateTimeField(auto_now=True)\r\n\r\n\r\nclass Comment(models.Model):\r\n    article = models.ForeignKey(Article, on_delete=models.CASCADE, releated_name='comments')\r\n    content = models.CharField(max_length=200)\r\n    created_at = models.DateTimeField(auto_now_add=True)\r\n    updated_at = models.DateTimeField(auto_now=True)\n</code></pre>\n<ul>\n<li><strong>on_delete</strong>\n<ul>\n<li>Referential Integrity: what to do when the parent instance is deleted</li>\n<li>CASCADE\n<ul>\n<li>The referencing instance is also deleted</li>\n</ul>\n</li>\n<li>PROTECT\n<ul>\n<li>Can't delete the parent instance</li>\n</ul>\n</li>\n<li>SET_NULL</li>\n<li>SET_DEFAULT</li>\n</ul>\n</li>\n<li><strong>related_name</strong>\n<ul>\n<li>The alias of the dereference manager</li>\n<li>Default value is <code>modelName_set</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>forms.py</strong></p>\n<pre><code class=\"language-python\"># articles/forms.py\r\nclass CommentForm(forms.ModelForm):\r\n\r\nclass Meta:\r\n    model = Comment\r\n    exclude = ('article',)\n</code></pre>\n</li>\n</ul>\n<h2>2.1. Create</h2>\n<ul>\n<li><strong>urls.py</strong>\n<pre><code class=\"language-python\"># articles/urls.py\r\nurlpatterns = [\r\n    ...,\r\n    path('&#x3C;int:pk>/comments/', views.comments_create, name='comments_create'),\r\n]\n</code></pre>\n</li>\n<li><strong>views.py</strong>\n<pre><code class=\"language-python\"># articles/views.py\r\ndef comments_create(request, pk):\r\n    article = Article.objects.get(pk=pk)\r\n    comment_form = CommentForm(request.POST)\r\n    if comment_form.is_valid():\r\n        comment = comment_form.save(commit=False)\r\n        comment.accounts = article\r\n        comment.save()\r\n    return redirect('movies:detail', pk)\n</code></pre>\n</li>\n<li><strong>detail.html</strong>\n<pre><code class=\"language-html\">&#x3C;!-- articles/detail.html -->\r\n&#x3C;form\r\n  action=\" {% url 'articles:comments_create' article.pk %} \"\r\n  method=\"POST\">\r\n  {% csrf_token %} {{ comment_form }}\r\n  &#x3C;input type=\"submit\" />\r\n&#x3C;/form>\n</code></pre>\n</li>\n</ul>\n<h2>2.2. Read</h2>\n<ul>\n<li><strong>views.py</strong>\n<pre><code class=\"language-python\"># articles/views.py\r\ndef detail(request, pk):\r\n    article = Article.objects.get(pk=pk)\r\n    comment_form = CommentForm()\r\n    # 역참조 manager 사용\r\n    # related_name 미선언 시, comment_set\r\n    comments = article.comments.all()\r\n    context = {\r\n        'movie': movie,,\r\n        'comment_form': comment_form,\r\n        'comments': comments\r\n    }\r\n    return render(request, 'articles/detail.html', context)\n</code></pre>\n</li>\n<li><strong>detail.html</strong>\n<pre><code class=\"language-html\">&#x3C;h4>댓글 목록&#x3C;/h4>\r\n&#x3C;ul>\r\n  {% for comment in comments %}\r\n  &#x3C;li>{{ comment.content }}&#x3C;/li>\r\n  {% endfor %}\r\n&#x3C;/ul>\n</code></pre>\n</li>\n</ul>\n<h2>2.3. Delete</h2>\n<ul>\n<li><strong>urls.py</strong>\n<pre><code class=\"language-python\"># articles/urls.py\r\nurlpatterns = [\r\n    ...,\r\n    path('&#x3C;int:article_pk>/comments/&#x3C;int:comment_pk>', views.comments_delete, name='comments_delete'),\r\n]\n</code></pre>\n</li>\n<li><strong>views.py</strong>\n<pre><code class=\"language-python\"># articles/views.py\r\ndef comments_delete(request, article_pk, comment_pk):\r\n    comment = Comment.objects.get(pk=comment_pk)\r\n    comment.delete()\r\n    return redirect('articles:detail', article_pk)\n</code></pre>\n</li>\n<li><strong>detail.html</strong>\n<pre><code class=\"language-html\">&#x3C;h4>댓글 목록&#x3C;/h4>\r\n&#x3C;ul>\r\n  {% for comment in comments %}\r\n  &#x3C;li>\r\n    {{ comment.content }}\r\n    &#x3C;form\r\n      action=\" {% url 'articles:comments_delete' article.pk comment_pk %} \"\r\n      method=\"POST\">\r\n      {% csrf_token %}\r\n      &#x3C;input type=\"submit\" value=\"DELETE\" />\r\n    &#x3C;/form>\r\n  &#x3C;/li>\r\n  {% endfor %}\r\n&#x3C;/ul>\n</code></pre>\n</li>\n</ul>\n<hr>\n<h1>3. Article : User (N:1)</h1>\n<ul>\n<li>\n<p><strong>models.py</strong></p>\n<pre><code class=\"language-python\"># articles/models.py\r\nfrom django.conf import settings\r\n\r\nclass Movie(models.Model):\r\nuser = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)\n</code></pre>\n</li>\n<li>\n<p><strong>forms.py</strong></p>\n<pre><code class=\"language-python\"># articles/forms.py\r\nclass ArticleForm(forms.ModelForm):\r\n\r\nclass Meta:\r\n    model = Comment\r\n    exclude = ('user',)\n</code></pre>\n</li>\n</ul>\n<h2>3.1. Create</h2>\n<ul>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\"># articles/views.py\r\n\r\n@login_required\r\n@require_http_methods(['GET', 'POST'])\r\ndef create(request):\r\n    if request.method == 'POST':\r\n        form = ArticleForm(request.POST)\r\n        if form.is_valid():\r\n            article = form.save(commit=False)\r\n            article.user = request.user\r\n            article.save()\r\n            return redirect('movies:detail', article.pk)\r\n    else:\r\n        form = ArticleForm()\r\n    context = {\r\n        'form': form,\r\n    }\r\n    return render(request, 'articles/create.html', context)\n</code></pre>\n</li>\n</ul>\n<h2>3.2. Update</h2>\n<ul>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">@login_required\r\n@require_http_methods(['GET', 'POST'])\r\ndef update(request, pk):\r\n    article = article.objects.get(pk=pk)\r\n    if request.user == article.user:\r\n        if request.method == 'POST':\r\n            form = ArticleForm(request.POST, instance=article)\r\n            if form.is_valid():\r\n                form.save()\r\n                return redirect('articles:detail', pk)\r\n        else:\r\n            form = ArticleForm(instance=article)\r\n        context = {\r\n            'article': article,\r\n            'form': form\r\n        }\r\n        return render(request, 'articles/update.html', context)\r\n    return HttpResponse(status=403)\n</code></pre>\n</li>\n<li>\n<p><strong>detail.html</strong></p>\n<pre><code class=\"language-html\">{% if request.user == article.user %}\r\n&#x3C;a href=\"{% url 'articles:update' article.pk %}\">UPDATE&#x3C;/a>\r\n&#x3C;form action=\"{% url 'articles:delete' article.pk %}\" method=\"POST\">\r\n  {% csrf_token %}\r\n  &#x3C;input type=\"submit\" value=\"DELETE\" />\r\n&#x3C;/form>\r\n{% endif %}\n</code></pre>\n</li>\n</ul>\n<h2>3.3. Delete</h2>\n<ul>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\"># articles/views.py\r\n\r\n@require_POST\r\ndef delete(request, pk):\r\n    article = Article.objects.get(pk=pk)\r\n    if request.user.is_authenticated:\r\n        if request.user == article.user:\r\n            article.delete()\r\n            return redirect('articles:index')\r\n        return HttpResponse(status=403) # 권한없음\r\n    return redirect('accounts:login')\n</code></pre>\n</li>\n<li>\n<p><strong>detail.html</strong></p>\n<pre><code class=\"language-html\">{% if request.user == article.user %}\r\n&#x3C;a href=\"{% url 'articles:update' article.pk %}\">UPDATE&#x3C;/a>\r\n&#x3C;form action=\"{% url 'articles:delete' article.pk %}\" method=\"POST\">\r\n  {% csrf_token %}\r\n  &#x3C;input type=\"submit\" value=\"DELETE\" />\r\n&#x3C;/form>\r\n{% endif %}\n</code></pre>\n</li>\n</ul>\n<hr>\n<h1>4. Comment : User (N:1)</h1>\n<ul>\n<li>\n<p><strong>models.py</strong></p>\n<pre><code class=\"language-python\"># articles/models.py\r\nclass Comment(models.Model):\r\n    article = models.ForeignKey(Article, on_delete=models.CASCADE, releated_name='comments'),\r\n    user = mmodels.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)\n</code></pre>\n</li>\n<li>\n<p><strong>forms.py</strong></p>\n<pre><code class=\"language-python\"># articles/forms.py\r\nclass CommentForm(forms.ModelForm):\r\n\r\nclass Meta:\r\n    model = Comment\r\n    exclude = ('article', 'user',)\n</code></pre>\n</li>\n</ul>\n<h2>4.1. Create</h2>\n<ul>\n<li><strong>views.py</strong>\n<pre><code class=\"language-python\"># articles/views.py\r\ndef comments_create(request, pk):\r\n    article = Article.objects.get(pk=pk)\r\n    comment_form = CommentForm(request.POST)\r\n    if comment_form.is_valid():\r\n        comment = comment_form.save(commit=False)\r\n        comment.accounts = article\r\n        comment.user = request.user\r\n        comment.save()\r\n    return redirect('movies:detail', pk)\n</code></pre>\n</li>\n</ul>\n<h2>4.2. Read</h2>\n<ul>\n<li><strong>detail.html</strong>\n<pre><code class=\"language-html\">&#x3C;h4>댓글 목록&#x3C;/h4>\r\n&#x3C;ul>\r\n  {% for comment in comments %}\r\n  &#x3C;li>{{ comment.user }}: {{ comment.content }}&#x3C;/li>\r\n  {% endfor %}\r\n&#x3C;/ul>\n</code></pre>\n</li>\n</ul>\n<h2>4.3. Delete</h2>\n<ul>\n<li><strong>views.py</strong>\n<pre><code class=\"language-python\"># articles/views.py\r\ndef comments_delete(request, article_pk, comment_pk):\r\n    comment = Comment.objects.get(pk=comment_pk)\r\n    if request.user == comment.user:\r\n        comment.delete()\r\n    return redirect('articles:detail', article_pk)\n</code></pre>\n</li>\n<li><strong>detail.html</strong>\n<pre><code class=\"language-html\">&#x3C;h4>댓글 목록&#x3C;/h4>\r\n&#x3C;ul>\r\n  {% for comment in comments %}\r\n  &#x3C;li>\r\n    {{ comment.user }}: {{ comment.content }} {% if request.user ==\r\n    comment.user %}\r\n    &#x3C;form\r\n      action=\" {% url 'articles:comments_delete' article.pk comment_pk %} \"\r\n      method=\"POST\">\r\n      {% csrf_token %}\r\n      &#x3C;input type=\"submit\" value=\"DELETE\" />\r\n    &#x3C;/form>\r\n    {% endif %}\r\n  &#x3C;/li>\r\n  {% endfor %}\r\n&#x3C;/ul>\n</code></pre>\n</li>\n</ul>"}},"pageContext":{"pagePath":"posts/Django/07_Django_Many_to_One.md","id":"f0d82e9d-bddf-53bb-807a-131e6603cd89","parent":{"id":"5c97a0f7-8d4f-5c28-bf40-a37bd2ae094a","name":"07_Django_Many_to_One","relativePath":"Django/07_Django_Many_to_One.md"}}},"staticQueryHashes":["1274812890","3935499650","82772122"],"slicesMap":{}}