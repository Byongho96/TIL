{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/Django/11_Django_REST_API.md/","result":{"data":{"markdownRemark":{"id":"c91cc39d-6475-5267-8ca7-b04b0fd14d60","html":"<h1>Django REST API</h1>\n<h2>Index</h2>\n<ul>\n<li><a href=\"#1-http\">1. HTTP</a>\n<ul>\n<li><a href=\"#11-http-%EC%A0%95%EC%9D%98\">1.1. HTTP 정의</a></li>\n<li><a href=\"#12-http%EC%9D%98-%ED%8A%B9%EC%A7%95\">1.2. HTTP의 특징</a></li>\n<li><a href=\"#13-http-request-methods\">1.3. HTTP Request Methods</a></li>\n<li><a href=\"#13-http-response-status-code\">1.3. HTTP Response Status Code</a></li>\n<li><a href=\"#14-uriuniform-resource-indentifier\">1.4. URI(Uniform Resource Indentifier)</a></li>\n<li><a href=\"#15-url-%EA%B5%AC%EC%A1%B0\">1.5. URL 구조</a></li>\n</ul>\n</li>\n<li><a href=\"#2-rest-api\">2. REST API</a>\n<ul>\n<li><a href=\"#21-api\">2.1. API</a></li>\n<li><a href=\"#22-restrestpresentational-state-trasfer\">2.2. REST(Restpresentational State Trasfer)</a></li>\n<li><a href=\"#23-json\">2.3. JSON</a></li>\n</ul>\n</li>\n<li><a href=\"#3-response-json\">3. Response JSON</a>\n<ul>\n<li><a href=\"#31-html-%EC%9D%91%EB%8B%B5\">3.1. HTML 응답</a></li>\n<li><a href=\"#22-jsonresponse%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-json-%EC%9D%91%EB%8B%B5\">2.2. JsonResponse()를 사용한 JSON 응답</a></li>\n<li><a href=\"#23-django-serializer%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-json-%EC%9D%91%EB%8B%B4\">2.3. Django Serializer를 사용한 JSON 응답</a></li>\n<li><a href=\"#24-django%EC%9D%98-rest-framework%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-json-%EC%9D%91%EB%8B%B5\">2.4. Django의 REST framework를 사용한 JSON 응답</a>\n<ul>\n<li><a href=\"#241-django-rest-framework\">2.4.1. Django REST framework</a></li>\n<li><a href=\"#242-modelserializer\">2.4.2. ModelSerializer</a></li>\n<li><a href=\"#243-example\">2.4.3. Example</a></li>\n<li><a href=\"#244-client%EC%9D%98-json-%EC%88%98%EC%8B%A0\">2.4.4. Client의 JSON 수신</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#3-django-rest-framework-single-model\">3. Django REST Framework, Single Model</a></li>\n<li><a href=\"#4-django-rest-framework-n1-relationship\">4. Django REST Framework, N:1 Relationship</a></li>\n<li><a href=\"#5-django-rest-framework-n1-relation-dereference\">5. Django REST Framework, N:1 Relation, Dereference</a></li>\n</ul>\n<hr>\n<h1>1. HTTP</h1>\n<h2>1.1. HTTP 정의</h2>\n<p>웹 상에서 리소스를 주고받는 규칙(프로토콜), 클라이언트와 서버는 요청과 응답을 주고 받는다.</p>\n<ul>\n<li><strong>요청(request)</strong>\n<ul>\n<li>클라이언트에 의해 전송되는 메시지</li>\n</ul>\n</li>\n<li><strong>응답(response)</strong>\n<ul>\n<li>서버에서 응답으로 전송되는 메시지</li>\n</ul>\n</li>\n</ul>\n<h2>1.2. HTTP의 특징</h2>\n<ul>\n<li><strong>Stateless(무상태)</strong>\n<ul>\n<li>동일한 연결에서 연속적으로 수행되는 두 요청 사이에 링크가 없음</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>쿠키와 세션</strong>\n<ul>\n<li>쿠키와 세션을 사용해 서버 상태를 요청에 함께 보냄</li>\n</ul>\n</li>\n</ul>\n<h2>1.3. HTTP Request Methods</h2>\n<p>클라이언트 요청 시, 리소스(데이터)에 대한 행위를 구분한다.</p>\n<ul>\n<li><strong>GET</strong>\n<ul>\n<li>서버에 리소스의 표현을 요청</li>\n</ul>\n</li>\n<li><strong>POST</strong>\n<ul>\n<li>데이터를 지정된 리소스에 제출</li>\n</ul>\n</li>\n<li><strong>PUT</strong>\n<ul>\n<li>요청한 주소의 리소스를 수정</li>\n</ul>\n</li>\n<li><strong>POST</strong>\n<ul>\n<li>지정된 리소스를 삭제</li>\n</ul>\n</li>\n</ul>\n<h2>1.3. HTTP Response Status Code</h2>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status\">HTTP Response Status Code Docs</a><br>\n특정 HTTP 요청에 대한 서버의 처리결과를 나타내며, 크게 5개의 그룹으로 나뉜다.</p>\n<ul>\n<li>Informational Responses (100~199)</li>\n<li>Successful Responses (200~299)</li>\n<li>Redirection Responses (300~399)</li>\n<li>Client Error Responses (400~499)</li>\n<li>Server Error Responses (500~599)</li>\n</ul>\n<h2>1.4. URI(Uniform Resource Indentifier)</h2>\n<p><strong>인터넷에서 하나의 리소스를 가리키는 문자열</strong></p>\n<ul>\n<li><strong>URN(Uniform Resource Name)</strong>\n<ul>\n<li>고유한 이름</li>\n</ul>\n</li>\n<li><strong>URL(Uniform Resource Locator)</strong>\n<ul>\n<li>리소스의 주소(위치)</li>\n</ul>\n</li>\n</ul>\n<h2>1.5. URL 구조</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/1dfe4cb9394dcb9260d7beb2918709a3/f4206/url_structure.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 9%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAACABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMBAv/aAAwDAQACEAMQAAAB1ZGZWHX/xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQMBAT8BEX//xAAWEQEBAQAAAAAAAAAAAAAAAAABEDL/2gAIAQIBAT8BNM//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAADAQAAAAAAAAAAAAAAAAAAAUEQ/9oACAEBAAE/IYR5/9oADAMBAAIAAwAAABD/AN//xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAwEBPxCJ/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA3/8QAGRABAAMBAQAAAAAAAAAAAAAAAQARIUGx/9oACAEBAAE/EKDJ2eUAoyf/2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"url_structure.jpg\" title=\"\" src=\"/TIL/static/1dfe4cb9394dcb9260d7beb2918709a3/4b190/url_structure.jpg\" srcset=\"/TIL/static/1dfe4cb9394dcb9260d7beb2918709a3/e07e9/url_structure.jpg 200w,\n/TIL/static/1dfe4cb9394dcb9260d7beb2918709a3/066f9/url_structure.jpg 400w,\n/TIL/static/1dfe4cb9394dcb9260d7beb2918709a3/4b190/url_structure.jpg 800w,\n/TIL/static/1dfe4cb9394dcb9260d7beb2918709a3/f4206/url_structure.jpg 1145w\" sizes=\"(max-width: 800px) 100vw, 800px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<ul>\n<li><strong>Schema</strong>\n<ul>\n<li>브라우저가 리소스를 이용하는 데 사용해야할 프로토콜</li>\n<li>Ex: https:, mailto:, ftp:</li>\n</ul>\n</li>\n<li><strong>Authority</strong>\n<ul>\n<li><strong>Domain Name(IP 주소)</strong>\n<ul>\n<li>요청중인 웹 서버를 나타냄</li>\n<li>Domain Name 대신 IP주소를 사용해도 된다.</li>\n</ul>\n</li>\n<li><strong>Port</strong>\n<ul>\n<li>웹 서버의 리소스에 접근하는데 사용되는 기술적인 문</li>\n<li>HTTP 프로토콜의 표준 포트는 생략 가능하다.\n<ul>\n<li>HTTP - 80</li>\n<li>HTTPS - 443</li>\n</ul>\n</li>\n<li>Django의 경우 8000이 기본 포트로 설정되어 있다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Path</strong>\n<ul>\n<li>웹 서버의 리소스 경로, 물리적 주소가 아닌 설계자에 의해 추상화된 경로</li>\n</ul>\n</li>\n<li><strong>Parameters</strong>\n<ul>\n<li>웹 서버에 제공하는 추가적인 데이터</li>\n<li>'&#x26;'기호로 구분되는 key-value 쌍 목록</li>\n</ul>\n</li>\n<li><strong>Anchor</strong>\n<ul>\n<li>리소스 내부 일정의 북마크를 나타내며, 브라우저의 해당 북마크 지점에서 콘텐츠를 표시</li>\n<li>'#'(부분 식별자)이후 부분은 서버에 전송되지 않고, 브라우저가 사용</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1>2. REST API</h1>\n<h2>2.1. API</h2>\n<p><strong>API(Application Programming Interface)</strong><br>\n애플리케이션과 프로그래밍으로 소통하는 방법. 복잡한 코드를 추상화하여 사용할 수 있는 쉬운 구문을 제공</p>\n<ul>\n<li><strong>Web API</strong>\n<ul>\n<li>웹 서버 또는 웹 브라우저를 위한 API</li>\n<li>주로 JSON 타입의 데이터를 응답</li>\n</ul>\n</li>\n<li><strong>Open API</strong>\n<ul>\n<li>개발자라면 누구나 사용할 수 있도록 공개된 API</li>\n</ul>\n</li>\n</ul>\n<h2>2.2. REST(Restpresentational State Trasfer)</h2>\n<p><strong>API Server를 개발하기 위한 일종의 소프트웨어 설계 방법론</strong></p>\n<ul>\n<li>\n<p><strong>특징</strong></p>\n<ul>\n<li><strong>자원의 식별</strong>\n<ul>\n<li>URI(URL)</li>\n</ul>\n</li>\n<li><strong>자원의 행위</strong>\n<ul>\n<li>HTTP Method</li>\n</ul>\n</li>\n<li><strong>자원의 표현</strong>\n<ul>\n<li>JSON</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2>2.3. JSON</h2>\n<p><strong>JavaScript의 표기법을 따른 단순 문자열</strong>로, 파이썬의 Dictionary 자바스크립트의 object처럼 C계열의 언어가 갖고 있는 자료구조로 쉽게 변환할 수 있는 key-value 형태의 구조를 가지고 있다.</p>\n<hr>\n<h1>3. Response JSON</h1>\n<p>Django는 현업에서 주로 백엔드 Framework로 쓰인다. 따라서 프론트엔드와 소통할 때 html 문서가 아닌 json으로 응답한다.</p>\n<h2>3.1. HTML 응답</h2>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\">from django.urls import path\r\nfrom . import views\r\n\r\nurlpatterns = [\r\n    path('html/', views.article_html),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from django.shortcuts import render\r\nfrom .models import Article\r\n\r\ndef article_html(request):\r\n    articles = Article.objects.all()\r\n    context = {\r\n      'articles': articles,\r\n    }\r\n    return render(request, 'articles/article.html', context)\n</code></pre>\n</li>\n<li>\n<p><strong>article.html</strong></p>\n<pre><code class=\"language-html\">...\r\n&#x3C;body>\r\n  &#x3C;h1>Article List&#x3C;/h1>\r\n  &#x3C;hr>\r\n  &#x3C;p>\r\n    {% for article in articles %}\r\n      &#x3C;h2>{{ article.pk }}번 글. {{ article.title }}&#x3C;/h2>\r\n      &#x3C;p>{{ article.content }}&#x3C;/p>\r\n      &#x3C;hr>\r\n    {% endfor %}\r\n  &#x3C;/p>\r\n&#x3C;/body>\n</code></pre>\n</li>\n</ul>\n<h2>2.2. JsonResponse()를 사용한 JSON 응답</h2>\n<p><strong>Serilaize</strong><br>\nQueryset 및 Model Instance와 같은 복잡한 데이터를 JSON, XML과 같은 쉽게 변환 할 수 있는 원시 데이터타입으로 변환시키는 것</p>\n<ul>\n<li><strong>JsonResponse()</strong>\n<ul>\n<li>JSON-encoded response를 만드는 클래스</li>\n<li><strong>safe</strong>\n<ul>\n<li>Default: True</li>\n<li>False로 설정 시 모든 타입의 객체를 serialization할 수 있음, True일 경우 dictionary만 가능</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\">from django.urls import path\r\nfrom . import views\r\n\r\nurlpatterns = [\r\n    path('json1/', views.jsonresponse),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from django.http.response import JsonResponse\r\nfrom .models import Article\r\n\r\ndef jsonresponse(request):\r\n    articles = Article.objects.all()\r\n    articles_json = []\r\n\r\n    for article in articles:\r\n        # 리스트[딕셔너리] 형태로 데이터를 형성\r\n        articles_json.append(\r\n            {\r\n                'id': article.pk,\r\n                'title': article.title,\r\n                'content': article.content,\r\n                'created_at': article.created_at,\r\n                'updated_at': article.updated_at,\r\n            }\r\n        )\r\n    return JsonResponse(articles_json, safe=False)\n</code></pre>\n</li>\n</ul>\n<h2>2.3. Django Serializer를 사용한 JSON 응답</h2>\n<ul>\n<li>\n<p><strong>serializers.serialize(format, object)</strong></p>\n<ul>\n<li>object를 format으로 변환해줌</li>\n<li><strong>format</strong>\n<ul>\n<li>'xml' / 'json' / 'jsonl' / 'yaml'</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>urls.py</strong></p>\n</li>\n</ul>\n<pre><code class=\"language-python\">from django.urls import path\r\nfrom . import views\r\n\r\nurlpatterns = [\r\n    path('json2/', views.django_serializer),\r\n]\n</code></pre>\n<ul>\n<li><strong>views.py</strong></li>\n</ul>\n<pre><code class=\"language-python\">from django.http.response import JsonResponse, HttpResponse\r\nfrom django.core import serializers\r\nfrom .models import Article\r\n\r\ndef django_serializer(request):\r\n    articles = Article.objects.all()\r\n    data = serializers.serialize('json', articles)\r\n    return HttpResponse(data, content_type='application/json')\n</code></pre>\n<h2>2.4. Django의 REST framework를 사용한 JSON 응답</h2>\n<h3>2.4.1. Django REST framework</h3>\n<p><strong>Django에서 RESTful API서버를 쉽게 구축할 수 있도록 도와주는 오픈소스 라이브러리</strong></p>\n<ul>\n<li>\n<p><strong>특징</strong></p>\n<ul>\n<li>Django의 Form, ModelForm과 유사하게 사용 가능하다.</li>\n</ul>\n</li>\n<li>\n<p><strong>설치 과정</strong></p>\n<ol>\n<li><code>pip install djangorestframework</code></li>\n<li><code>INSTALLED_APPS = [ 'rest_framework' ]</code></li>\n</ol>\n</li>\n</ul>\n<h3>2.4.2. ModelSerializer</h3>\n<p><strong>ModelSerializer 클래스는 Model Class를 바탕으로 형성하는 Serializer 클래스.</strong> <a href=\"https://www.django-rest-framework.org/api-guide/serializers/\">Serializer와 Deserialize와 관련한 다양한 메소드를 가진다</a></p>\n<ul>\n<li><strong>ModelSerializer(obj, ..., many=False)</strong>\n<ul>\n<li><strong>obj</strong>\n<ul>\n<li>Model의 객체 <code>obj</code>를 첫번째 인자로 받는다.</li>\n</ul>\n</li>\n<li><strong>many</strong>\n<ul>\n<li>True일 경우, 여러 개의 객체를 받을 수 있다.</li>\n</ul>\n</li>\n<li><strong>is_valid()</strong>\n<ul>\n<li>제출된 Serializer가 정의된 Model 구조에 유효한지를 검사</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>ModelSerializer는 Model 객체를 인자로 받아, 원시 파이선 데이터 타입으로 바꾼다. 이는 JSON은 아니지만 JSON으로 변환되기 쉬운 데이터 타입이다. 나중에 Response()시 renderer가 해당 원시타입(serializer.data)을 처리하여 보낸다.</p>\n<h3>2.4.3. Example</h3>\n<ul>\n<li>\n<p><strong>serializers.py</strong></p>\n<pre><code class=\"language-python\">from rest_framework import serializers\r\nfrom .models import Article\r\n\r\n\r\nclass ArticleSerializer(serializers.ModelSerializer):\r\n\r\n    class Meta:\r\n        model = Article\r\n        fields = '__all__'\n</code></pre>\n</li>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\">from django.urls import path\r\nfrom . import views\r\n\r\nurlpatterns = [\r\n    path('json3/', views.RESTserializer),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from rest_framework.decorators import api_view\r\nfrom rest_framework.response import Response\r\n\r\nfrom .serializers import ArticleSerializer\r\nfrom .models import Article\r\n\r\n@api_view()\r\ndef RESTserializer(request):\r\n    articles = Article.objects.all()\r\n    serializer = ArticleSerializer(articles, many=True)\r\n    return Response(serializer.data)\n</code></pre>\n</li>\n</ul>\n<h3>2.4.4. Client의 JSON 수신</h3>\n<ul>\n<li><code>requests.get(url: str, params={key: value}, args)</code>\n<ul>\n<li>returns <code>requests.Response</code> object</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-python\"># pip install requests\r\nimport requests\r\nfrom pprint import pprint\r\n\r\n# 요청을 보냄\r\nresponse = requests.get('http://127.0.0.1:8000/api/v1/json3/')\r\n# json(): requests.Response -> dict\r\nresult = response.json()\r\n\r\n# json.dumps() 등의 메소드는 dict &#x3C;-> json\r\n\r\npprint(result)\n</code></pre>\n<hr>\n<h1>3. Django REST Framework, Single Model</h1>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\">from django.urls import path\r\nfrom . import views\r\n\r\nurlpatterns = [\r\n    path('articles/', views.article_list),\r\n    path('articles/&#x3C;int:article_pk>/', views.article_detail),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>serializers.py</strong></p>\n<pre><code class=\"language-python\">from rest_framework import serializers\r\nfrom .models import Article\r\n\r\n# 데이터의 어떠한 field를 read할 것이냐에 따라 Serializer를 만든다!!!!\r\n\r\nclass ArticleListSerializer(serializers.ModelSerializer):\r\n\r\n    class Meta:\r\n        model = Article\r\n        fields = ('id', 'title', 'contnet', )\r\n\r\nclass ArticleSerializer(serializers.ModelSerializer):\r\n\r\n  class Meta:\r\n      model = Article\r\n      fields = '__all__'\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from rest_framework.response import Response\r\nfrom rest_framework.decorators import api_view\r\nfrom rest_framework import status\r\nfrom django.shortcuts import get_object_or_404, get_list_or_404\r\nfrom .serializers import ArticleListSerializer, ArticleSerializer, CommentSerializer\r\nfrom .models import Article, Comment\r\n\r\n@api_view(['GET', 'POST'])   # decorator가 필수적으로 붙는다.\r\ndef article_list(request):\r\n    if request.method == 'GET':\r\n        # articles = Article.objects.all()\r\n        articles = get_list_or_404(Article)\r\n        serializer = ArticleListSerializer(articles, many=True)\r\n        return Response(serializer.data)\r\n\r\n    elif request.method == 'POST':\r\n        serializer = ArticleSerializer(data=request.data) # 이것은 그냥 최종적으로 제출되는 JSON에 다라서 설정\r\n        if serializer.is_valid(raise_exception=True):\r\n            serializer.save()\r\n            return Response(serializer.data, status=status.HTTP_201_CREATED)\r\n        # return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\r\n\r\n\r\n@api_view(['GET', 'DELETE', 'PUT'])\r\ndef article_detail(request, article_pk):\r\n    # article = Article.objects.get(pk=article_pk)\r\n    article = get_object_or_404(Article, pk=article_pk)\r\n\r\n    if request.method == 'GET':\r\n        serializer = ArticleSerializer(article)\r\n        return Response(serializer.data)\r\n\r\n    elif request.method == 'DELETE':\r\n        article.delete()\r\n        return Response(status=status.HTTP_204_NO_CONTENT)\r\n\r\n    elif request.method == 'PUT':\r\n        serializer = ArticleSerializer(article, data=request.data)\r\n        if serializer.is_valid(raise_exception=True):\r\n            serializer.save()\r\n            return Response(serializer.data)\n</code></pre>\n</li>\n<li>\n<p><code>'api_view'== decorator</code></p>\n<ul>\n<li>해당 함수가 허용하는 HTTP 메소드 목록을 정의하며, 필수로 붙여줘야 한다.</li>\n<li>다른 메소드 요청에 대해서는 <strong>405 Method Not Allowed</strong>로 응답한다.</li>\n</ul>\n</li>\n<li>\n<p><code>get_object_or_404(Model, {options})</code></p>\n<ul>\n<li>데이터베이스에서 option을 만족하는 객체를 ==하나==찾아 반환한다.</li>\n<li>없을 경우, <strong>404 Not Found</strong>로 응답한다.</li>\n</ul>\n</li>\n<li>\n<p><code>get_list_or_404(Model, {options})</code></p>\n<ul>\n<li>데이터베이스에서 option을 만족하는 객체를 모두 찾아 리스트로 반환한다.</li>\n<li>없을 경우, <strong>404 Not Found</strong>로 응답한다.</li>\n</ul>\n</li>\n<li>\n<p><code>serializer.is_valid(raise_exception=True)</code></p>\n<ul>\n<li>유효성 검사를 통과하지 못할 경우, <strong>400 Bad Request</strong>와 함께 관련된 데이터를 돌려보낸다.</li>\n</ul>\n</li>\n<li>\n<p><code>Response(data, ..., status)</code></p>\n<ul>\n<li>보낼 data를 데이터를 첫번재 인자로 받고, status는 http response method를 의미한다.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1>4. Django REST Framework, N:1 Relationship</h1>\n<ul>\n<li>\n<p><strong>urls.py</strong></p>\n<pre><code class=\"language-python\">from django.urls import path\r\nfrom . import views\r\n\r\nurlpatterns = [\r\n    path('comments/', views.comment_list),\r\n    path('comments/&#x3C;int:comment_pk>/', views.comment_detail),\r\n]\n</code></pre>\n</li>\n<li>\n<p><strong>serializers.py</strong></p>\n<pre><code class=\"language-python\">from rest_framework import serializers\r\nfrom .models import Comment\r\n\r\n# 데이터의 어떠한 field를 read할 것이냐에 따라 Serializer를 만든다!!!!\r\n\r\nclass CommentSerializer(serializers.ModelSerializer):\r\n\r\n  class Meta:\r\n      model = Comment\r\n      fields = '__all__'\r\n      read_only_fields = ('article',) # 생성 시에 is_valid()를 무사히 통과한 뒤에 별도로 넣어 줌. is_valid()에서 제외시킨다.\r\n      # Form 기능도 가지고 있다고 생각하자.\n</code></pre>\n</li>\n<li>\n<p><strong>views.py</strong></p>\n<pre><code class=\"language-python\">from rest_framework.response import Response\r\nfrom rest_framework.decorators import api_view\r\nfrom rest_framework import status\r\nfrom django.shortcuts import get_object_or_404, get_list_or_404\r\nfrom .serializers import ArticleListSerializer, ArticleSerializer, CommentSerializer\r\nfrom .models import Article, Comment\r\n\r\n@api_view(['GET'])\r\ndef comment_list(request):\r\n    if request.method == 'GET':\r\n        # comments = Comment.objects.all()\r\n        comments = get_list_or_404(Comment)\r\n        serializer = CommentSerializer(comments, many=True)\r\n        return Response(serializer.data)\r\n\r\n@api_view(['POST'])\r\ndef comment_create(request, article_pk):\r\n    # article = Article.objects.get(pk=article_pk)\r\n    article = get_object_or_404(Article, pk=article_pk)\r\n    serializer = CommentSerializer(data=request.data)\r\n    if serializer.is_valid(raise_exception=True):\r\n        serializer.save(article=article)    # 저장 전에, 외래키 값을 넣음.\r\n        return Response(serializer.data, status=status.HTTP_201_CREATED)\r\n\r\n@api_view(['GET', 'DELETE', 'PUT'])\r\ndef comment_detail(request, comment_pk):\r\n    # comment = Comment.objects.get(pk=comment_pk)\r\n    comment = get_object_or_404(Comment, pk=comment_pk)\r\n\r\n    if request.method == 'GET':\r\n        serializer = CommentSerializer(comment)\r\n        return Response(serializer.data)\r\n\r\n    elif request.method == 'DELETE':\r\n        comment.delete()\r\n        return Response(status=status.HTTP_204_NO_CONTENT)\r\n\r\n    elif request.method == 'PUT':\r\n        serializer = CommentSerializer(comment, data=request.data)\r\n        if serializer.is_valid(raise_exception=True):\r\n            serializer.save()\r\n            return Response(serializer.data)\n</code></pre>\n</li>\n</ul>\n<hr>\n<h1>5. Django REST Framework, N:1 Relation, Dereference</h1>\n<ul>\n<li>\n<p><strong>serializers.py</strong></p>\n<pre><code class=\"language-python\">from rest_framework import serializers\r\nfrom .models import Comment\r\n\r\nclass CommentSerializer(serializers.ModelSerializer):\r\n\r\nclass ArticleSerializer(serializers.ModelSerializer):\r\n  # comment_set = serializers.PrimaryKeyRelatedField(many=True, read_only=True)\r\n  comment_set = CommentSerializer(many=True, read_only=True)\r\n  comment_count = serializers.IntegerField(source='comment_set.count', read_only=True)\r\n\r\n  class Meta:\r\n      model = Article\r\n      fields = '__all__'\n</code></pre>\n<ul>\n<li><mark>외래키 <strong>참조/역참조</strong>하는 객체에 대한 Serializer를 참조할 때는 반드시 이름을 <strong>필드명/역참조 매니저</strong>와 일치시켜줘야 한다.</mark> 그래야지 Serializer에 어떤 객체를 넣어야할지 id값으로 장고가 처리할 수 있다.</li>\n<li><strong>source</strong>\n<ul>\n<li>받은 객체에 대한 ORM을 작성한다.</li>\n</ul>\n<ul>\n<li>Ex. <code>Article.comment_set.count() -> 'comment_set.count'</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"}},"pageContext":{"pagePath":"posts/Django/11_Django_REST_API.md","id":"c91cc39d-6475-5267-8ca7-b04b0fd14d60","parent":{"id":"504ea83b-1e5d-5536-8c5a-ff13b99c1b13","name":"11_Django_REST_API","relativePath":"Django/11_Django_REST_API.md"}}},"staticQueryHashes":["1274812890","3935499650","82772122"],"slicesMap":{}}