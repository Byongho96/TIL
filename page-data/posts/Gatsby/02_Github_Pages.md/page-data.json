{"componentChunkName":"component---src-templates-post-index-tsx","path":"/posts/Gatsby/02_Github_Pages.md/","result":{"data":{"markdownRemark":{"id":"cf0e5891-24f0-5538-92fd-24668355fe2f","html":"<h1 id=\"1-프론트엔드-배포란\" style=\"position:relative;\"><a href=\"#1-%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C-%EB%B0%B0%ED%8F%AC%EB%9E%80\" aria-label=\"1 프론트엔드 배포란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 프론트엔드 배포란?</h1>\n<p>프론트엔드 배포를 한 마디로 정리하면, <strong>특정 url을 통한 GET요청에 대해 index.html을 반환하도록 설정</strong>하는 것을 말한다.</p>\n<p>처음 배포를 공부할 때, 나는 백엔드보다 오히려 프론트엔드의 배포를 이해하기 더 어려웠다. 백엔드를 배포한다는 것은, 클라이언트의 요청을 WAS(Web Application Server)가 동적으로 처리해 결과를 반환할 수 있도록, 서버에 백엔드 프로젝트(어플리케이션)를 구동하는 것을 말한다. 그런데 도대체 프론트엔드를 배포한다는게 무슨 말일까?</p>\n<p>다음 예시를 통해 프론트엔드 배포의 한 번 설명해보겠다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/ef37963c1dfed53ff4c502af95571639/4cdc7/naver.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 43.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABTUlEQVR42m2SCY6DMAxFuf8tyx6yE8hCoH9kV8O01Vj6IgmO/WynafsBwyQwLwpCacxSoe16PIYFyjhIbbAoDSEVlDYs51f4NXxoDRv/a7quh9YGIWxIKSGmBKkUBznPE7kUOO8RY8JxHLiui8/fVWsF2TiOaLq+h3cOOWfUerC01pBS4vl8IpUMoRbU43XpPyM/smma0IzjzAvvPWcqpTCxWBasISDngrDt2GNiShKdvSslgjnRdR2aYZw5GJVLJZGU0hiG4WPvnMMaVt7fZF+EQgg0RGe0YUfqBxFSAlqTETWVb627E7+UuU2kGCPf37YNTd+1eDxazLPg3pEz0dCXjByNMTfJ31CujwERIwfUSnEgkrX2DqCk4uxEbIy9aUi/JX4PhQPOYoGhctbX29LG3kPZ9x3lOGCdwx4jB6dnVOmpvOmoFed1cUt+AHBntyv/qCqHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"naver network\" title=\"\" src=\"/TIL/static/ef37963c1dfed53ff4c502af95571639/8c557/naver.png\" srcset=\"/TIL/static/ef37963c1dfed53ff4c502af95571639/4edbd/naver.png 175w,\n/TIL/static/ef37963c1dfed53ff4c502af95571639/13ae7/naver.png 350w,\n/TIL/static/ef37963c1dfed53ff4c502af95571639/8c557/naver.png 700w,\n/TIL/static/ef37963c1dfed53ff4c502af95571639/e996b/naver.png 1050w,\n/TIL/static/ef37963c1dfed53ff4c502af95571639/4cdc7/naver.png 1327w\" sizes=\"(max-width: 700px) 100vw, 700px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<ol>\n<li>브라우저에 '<a href=\"http://www.naver.com/&#x27;%EC%9D%84\">http://www.naver.com/'을</a> 입력했다고 가정해보자</li>\n<li>이는 곧 해당 URL(IP 주소)로 GET 요청을 보내는 것이다</li>\n<li>URL(IP 주소)에 대응하는 서버는 네이버 홈페이지 HTML파일을 반환한다.</li>\n<li>이 때 HTTP/2의 특징으로 HTML파일이 참조하는 JS, CSS, img, ... 등도 서버에서 한꺼번에 보내준다.</li>\n<li>브라우저는 받은 HTML을 나머지 정적 파일들과 함께 렌더링하여 화면에 보여준다.</li>\n</ol>\n<p>즉, 백엔드와 프론트엔드 배포는 큰 틀에서 동일하게 동작한다. 다만 프론트엔드는 GET만을 받아 JSON이 아닌 정적파일(html, js, css, ...)을 반환하는 차이점이 있을 뿐이다. 이렇게 url에 대해서 정적인 콘텐츠를 반환할 뿐이기에, 프론트엔드만을 배포하기 위해서 24시간 돌아가는 컴퓨팅 자원을 관리하는 것을 배보다 배꼽이 큰 격이다. 이런 경우 Netflify나 Gihub Pages와 같은 정적 콘텐츠 제공 서비스를 사용할 수 있다.</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"center\">백엔드</th>\n<th align=\"center\">프론트엔드</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Method</td>\n<td align=\"center\">GET, POST, PUT, DELETE ...</td>\n<td align=\"center\">GET</td>\n</tr>\n<tr>\n<td>Process</td>\n<td align=\"center\">요청에 따라 동적</td>\n<td align=\"center\">모든 요청에 정적 (SSR 제외)</td>\n</tr>\n<tr>\n<td>Return</td>\n<td align=\"center\">JSON</td>\n<td align=\"center\">html (js, css, static)</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"2-github-pages\" style=\"position:relative;\"><a href=\"#2-github-pages\" aria-label=\"2 github pages permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. GitHub Pages</h1>\n<p><a href=\"https://docs.github.com/ko/pages/getting-started-with-github-pages/creating-a-github-pages-site\">GitHub Pages</a>는 GitHub에서 제공하는 정적 웹사이트 호스팅 서비스이다. GitHub 리포지토리에 저장된 정적 파일(HTML, CSS, JavaScript)을 url 요청이 들어오면 제공하는 것이다.</p>\n<p>어떠한 github 레포지토리든지 Settings > Pages 에 들어가면, 아래 사진에서 볼 수 있는 것처럼 특정 Branch를 바라보도록 설정할 수 있다. 그러면 GitHub Pages는 해당 브랜치의 최상단 디렉토리에서 <mark style='background-color: #fff5b1'><strong>index.html, index.md, README.md</strong></mark> 3가지 파일을 호스팅할 사이트의 <strong>시작 파일</strong>로 관찰하고 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/ae895da16b9e7f6236c291d77bbfa608/4f1dd/github-pages.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.714285714285715%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABh0lEQVR42o2SO2/dMAxG/f//S6auXbJ06xwEuMhSNMmtrfdbsn0KycltjLZoCXwgSEHkIaXp8fLELBRSW37MkkVqfMx/UcGFgtIvSHXB+nA7cyENTco4dJf1CKnpsXEB6+OQDwljPcZ5rIsYq5HXT8jXO1JaSHkj5ULKdWhqrZFSAnY+mnMOKSXGGH6zTcD6nT/ZUTBn9nM9Ym64kAkhUEoZTQ9Fcq7EVMk5k2Iafn8DmmqtKKkG0bZtI7nvOyFErPVorXHOj7Oz1lN8InQujO77B8zeoNPFmKit8b829XG0Mbdi67YNfCkNUhms8+RSTjTr2nUQriPeeYecUk4oJW8dciuUtWLMC9pc8TFSax57yumX7xONHXZfGqXt74T9cqC17YRe0yMlPmGukXkptwv/HNm5B5brF6K/DOxjlB2tPXLWPNxf+Hz/jefF00onelM8Xj3GONTjvr5Jyq8sz3fU/EBtjAdo64a1BiEFLlhiMGilEEIghRy/Yp6X8U/FcuSEkGMFPwGmzFdbyxMs9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"github-pages\" title=\"\" src=\"/TIL/static/ae895da16b9e7f6236c291d77bbfa608/8c557/github-pages.png\" srcset=\"/TIL/static/ae895da16b9e7f6236c291d77bbfa608/4edbd/github-pages.png 175w,\n/TIL/static/ae895da16b9e7f6236c291d77bbfa608/13ae7/github-pages.png 350w,\n/TIL/static/ae895da16b9e7f6236c291d77bbfa608/8c557/github-pages.png 700w,\n/TIL/static/ae895da16b9e7f6236c291d77bbfa608/e996b/github-pages.png 1050w,\n/TIL/static/ae895da16b9e7f6236c291d77bbfa608/2cefc/github-pages.png 1400w,\n/TIL/static/ae895da16b9e7f6236c291d77bbfa608/4f1dd/github-pages.png 1567w\" sizes=\"(max-width: 700px) 100vw, 700px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>내 TIL 레포지토리에 대한 Gihub Pages 설정을 보며 더 자세하게 설명해보도록 하겠다.</p>\n<ul>\n<li>Default url은 <code class=\"language-text\">{Github ID}.github.io/{레포지토리 이름}/</code>이다.\n<ul>\n<li>아래 예시의 경우, <code class=\"language-text\">byongho96/github.io/TIL/</code></li>\n</ul>\n</li>\n<li>지켜 볼 Branch와 Directory를 설정할 수 있다.\n<ul>\n<li>아래 예시의 경우, <code class=\"language-text\">gh-pages</code> 브랜치의 최상단 디렉토리(<code class=\"language-text\">/root</code>)를 바라보고 있다.</li>\n<li>해당 위치에 index.html, index.md, README.md 가 들어올 경우, 이를 제공한다.</li>\n</ul>\n</li>\n</ul>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/01294/github-pages-setting.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 49.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABZUlEQVR42oVS207sMAzs/38dD/C4CImFA8tuc7FzTzwoLl1AIM5IE+fSjid2lqd/JxweHmE9KylmcMwa97muwx4TLtbjbLzOQypK+jhbOCY4z/AU4ChoJI7b2hM8R8xv5h6FCOIAZx2c88i1I9eGXD65CAQ5F/Te8RUpZ6zGwliH3gdEsHEIRAbG+M4dyxw4BIQQvh3U2uE4g8iA6AiiZ3g6IvAFOVfEmNRISknZeoeIbIIpzR8JpRQVE0AdO5/w8vqIs7mDsXfwdIvWTh8p5ZqcQwRzRGtjEyRm5VeHrTXUWtRFrduVd5npZCN+YJl7McZrDado7RXMjLe3E4wx8N5CpO9y+AtbDTkg57w5EEEfXZ0ZF/W5zO6NIZp0jK6xd8H41aEIzOzmuqrYtcvJ43K+BfMznL2Hcw9aq5lo1rrUgfaL4tK64PhyxrpaxFQQU0ZMFaUQ7HoD559wMQeQP6CUhv/hHQjmDTM4IDbtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"github-pages-setting\" title=\"\" src=\"/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/8c557/github-pages-setting.png\" srcset=\"/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/4edbd/github-pages-setting.png 175w,\n/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/13ae7/github-pages-setting.png 350w,\n/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/8c557/github-pages-setting.png 700w,\n/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/e996b/github-pages-setting.png 1050w,\n/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/2cefc/github-pages-setting.png 1400w,\n/TIL/static/6e2b9994a54834efc7ddf7fb12868d99/01294/github-pages-setting.png 1615w\" sizes=\"(max-width: 700px) 100vw, 700px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<h2 id=\"21-gh-pages\" style=\"position:relative;\"><a href=\"#21-gh-pages\" aria-label=\"21 gh pages permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.1. gh-pages</h2>\n<p>그럼 우리는 index.html을 포함한 정적 파일을 특정 브랜치에 업로드하기만 하면 된다. 이를 도와주는 라이브러리가 <a href=\"https://www.npmjs.com/package/gh-pages-cli\">gh-pages</a>이다. gh-pages의 역할을 간단하다. 그냥 레포지토리에 브랜치를 생성하고, 해당 브랜치에 정적파일을 업로드 하는 것이다.</p>\n<p>사용법은 다음과 같다.</p>\n<ol>\n<li>\n<p><strong>gh-pages 설치</strong></p>\n<p>npm 패키지 설치 시, cli 명령도 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cli\"><pre class=\"language-cli\"><code class=\"language-cli\">npm install gh-pages --save-dev</code></pre></div>\n</li>\n<li>\n<p><strong>gh-pages CLI 구동</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cli\"><pre class=\"language-cli\"><code class=\"language-cli\">gh-pages\n\n옵션\n-d {타겟 디렉토리}: 올리고자 하는 타겟 디렉토리이다. 기본값은 현재 위치이다.\n-b {타겟 브랜치}: 올리려는 타겟 브랜치이다. 기본값은 gh-pages이다.</code></pre></div>\n</li>\n</ol>\n<h2 id=\"22-gatsby-and-gh-pages\" style=\"position:relative;\"><a href=\"#22-gatsby-and-gh-pages\" aria-label=\"22 gatsby and gh pages permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.2. Gatsby and gh-pages</h2>\n<p><a href=\"https://www.gatsbyjs.com/docs/how-to/previews-deploys-hosting/how-gatsby-works-with-github-pages/\">Gatsby 공식문서</a>에서는 Gatsby 프로젝트를 gh-pages를 어떻게 배포할지 설명해주고 있다. 그런데 살펴보면 별거 없다. <strong>그냥 Gatsby를 먼저 빌드하고, 이걸 <code class=\"language-text\">gh-pages</code>명령어로 GitHub에 푸시하라는 말이다.</strong></p>\n<ol>\n<li>\n<p><strong>gh-pages 설치</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cli\"><pre class=\"language-cli\"><code class=\"language-cli\">npm install gh-pages --save-dev</code></pre></div>\n</li>\n<li>\n<p><strong>pathPrefix 설정</strong></p>\n<p>Github Pages로 웹사이트를 호스팅하면 따로 커스텀 도메인을 설정해주지 않는 이상, 레포지토리 명을 url 주소의 prefix로 가져간다. 이를 반영해서 Gatsby 프로젝트를 반영하기 위해 <code class=\"language-text\">gatsby-config.js</code>파일에 다음 설정을 해줘야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-config.js</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">pathPrefix</span><span class=\"token operator\">:</span> <span class=\"token string\">'/{레포지토리 이름}'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p><strong>커스텀 script 설정</strong></p>\n<p>다음과 같이 pacakge.json에서 커스텀 script를 설정한다. <code class=\"language-text\">npm run deploy</code>를 입력하면, <code class=\"language-text\">gatsby build --prefix-paths &amp;&amp; gh-pages -d public</code>명령어를 실행시키도록 하겠다는 것이다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">gatsby build --prefix-paths</code></p>\n<ul>\n<li>설정해 둔 <code class=\"language-text\">pathPrefix</code>를 반영해서 Gatsby 프로젝트를 빌드한다.</li>\n<li>빌드 결과물은 자동으로 <code class=\"language-text\">/public</code>폴더에 저장된다.</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">gh-pages -d public</code></p>\n<ul>\n<li><code class=\"language-text\">public</code>폴더의 내용물을 <code class=\"language-text\">gh-pages</code>브랜치에 push한다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// package.json</span>\n\n <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build --prefix-paths &amp;&amp; gh-pages -d public\"</span>\n    <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<h1 id=\"3-github-actions\" style=\"position:relative;\"><a href=\"#3-github-actions\" aria-label=\"3 github actions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Github Actions</h1>\n<p>Github Actions는 GitHub에서 제공하는 CI/CD 서비스이다.</p>\n<p>더 직관적으로 설명하면 이렇다. YAML형식의 워크플로우 파일을 등록하여, <strong>특정 이벤트(push, merge, pull ...)가 일어났을 때, 내가 설정해둔 작업을 자동 실행시킬 수 있다.</strong></p>\n<p>그러면 내가 master 브랜치에 머지했을 때 <code class=\"language-text\">npm run deploy</code>명령어가 돌아가도록, 형식에 맞춰 워크플로우를 작성해서 등록하면 자동배포 끝이다!</p>\n<p>근데 항상 생각대로 되지 않기 마련이다... 아래는 내가 처음에 작성했던 간단한 워크플로이다. 마지막 <code class=\"language-text\">npm run deploy</code>부분에서 인증에러가 발생했다. 아무리 내 레포지토리로 push를 하는 것이라고 해도, 실제 워크플로 작업이 일어나는 공간은 Github Cloud이기 때문에 인증에러가 발생하는 것이라고 추측한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy GitHub Pages\n\n<span class=\"token comment\"># master 브랜치에 push 작업이 발생했을 때,</span>\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n\n<span class=\"token comment\"># 아래 작업을 실행시킨다.</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest <span class=\"token comment\"># 작업 실행 OS 설정</span>\n    <span class=\"token key atrule\">permissions</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 저장소에 대해 쓰기 권한을 부여한다.</span>\n      <span class=\"token key atrule\">contents</span><span class=\"token punctuation\">:</span> write\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3 <span class=\"token comment\"># 현재 저장소를 checkout해서 코드를 가져온다.</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup Node <span class=\"token comment\"># Node 환경을 셋팅한다.</span>\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'18'</span> <span class=\"token comment\"># 내가 사용한 Node 버전</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm ci <span class=\"token comment\"># npm 패키지를 설치</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run deploy <span class=\"token comment\"># gatsby build --prefix-paths &amp;&amp; gh-pages -d public</span></code></pre></div>\n<h2 id=\"31-peaceirisactions-gh-pages\" style=\"position:relative;\"><a href=\"#31-peaceirisactions-gh-pages\" aria-label=\"31 peaceirisactions gh pages permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1. peaceiris/actions-gh-pages</h2>\n<p>그래서 인증과 gh-pages를 함께 처리할 수 있는 action을 찾기 시작했다. <strong>actions 이란, 워크플로우에서 재사용할 수 있는 기능 단위의 모듈이라고 생각할 수 있다.</strong> <code class=\"language-text\">actions/checkout</code> Github에서 공식적으로 제공하는 액션도 있고, 다른 개발자들이 만든 action도 있다.</p>\n<p>그런데 구글링해서 찾아본 대부분의 글에서는 Personal Access Token을 발급받아 배포를 진행했다. 나는 다음과 같은 이유로 이 부분이 조금 꺼림직했다.</p>\n<ul>\n<li>내 레포지토리로 push를 하는 것인데, Personal Access Token이 정말 필요할지 의문이었다.</li>\n<li>Github 공식 Action도 아닌데 Personal Access Token을 사용하기가 꺼려졌다.</li>\n<li><strong>무엇보다 Persnal Access Token은 만료기간이 있어서 주기적으로 갱신해줘야 한다.</strong></li>\n</ul>\n<p>그러던 중 구세주를 만났다. 바로 이 <a href=\"https://github.com/peaceiris/actions-gh-pages\">peaceiris/actions-gh-pages</a>이다. 링크를 타고 들어가면 다음과 같은 사용예시와 설명을 볼 수 있다. 한 마디로 <code class=\"language-text\">GIHUB_TOKEN</code>이라는 값을 사용하기는 하는데, 이건 Personal Access Token이 아니라 Github Actions Runner가 인증을 위해 자동생성하는 값이다. 때문에 우리는 어떠한 추가 설정없이 바로 해당 action을 사용할 수 있다!</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public</code></pre></div>\n<blockquote>\n<p>For newbies of GitHub Actions: Note that the GITHUB_TOKEN is NOT a personal access token. A GitHub Actions runner automatically creates a GITHUB_TOKEN secret to authenticate in your workflow. So, you can start to deploy immediately without any configuration.</p>\n</blockquote>\n<p>여기서 끝이 아니다! 프레임워크 별로 구체적인 예시 코드까지 정리해 놓으셨다. 이렇게 똑똑하고 친절한 개발자는 복 받을 거다. 아래는 내가 아주 살짝 커스텀한 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GitHub Pages\n\n<span class=\"token comment\"># master 브랜치에 push 작업이 발생했을 때,</span>\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest <span class=\"token comment\"># 작업 실행 OS 설정</span>\n    <span class=\"token key atrule\">permissions</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 저장소에 대해 쓰기 권한을 부여한다.</span>\n      <span class=\"token key atrule\">contents</span><span class=\"token punctuation\">:</span> write\n    <span class=\"token key atrule\">concurrency</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 작업 동시성을 제어한다 (하단 설명 참조)</span>\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.workflow <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.ref <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3 <span class=\"token comment\"># 현재 저장소를 checkout해서 코드를 가져온다.</span>\n\n      <span class=\"token comment\"># Node 환경을 셋팅한다.</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup Node\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'18'</span> <span class=\"token comment\"># 내가 사용한 노드 버전</span>\n\n      <span class=\"token comment\"># 캐시 관리</span>\n      <span class=\"token comment\"># 다운로드한 패키지를 캐시하여 다음 실행 시에 다시 다운로드하지 않는다. (하단 설명 참조)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Cache dependencies\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ~/.npm\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> hashFiles('<span class=\"token important\">**/package-lock.json')</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">restore-keys</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{ runner.os }}-node-</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm ci\n      <span class=\"token comment\">#   - run: npm run format</span>\n      <span class=\"token comment\">#   - run: npm run test</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> github.ref == 'refs/heads/main'\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public</code></pre></div>\n<ul>\n<li>\n<p><strong>concurrency</strong><br>\nconcurrency는 동시성을 제어하는 옵션으로, 그룹 내에서 여러 작업이 동시 실행되는 것을 제한할 수 있다.</p>\n<p>위 코드에서는 group 속성에 <code class=\"language-text\">${{ github.workflow }}-${{ github.ref }}</code> 값을 사용하고 있다. <code class=\"language-text\">${{ github.workflow }}</code>는 현재 워크플로우 이름을, <code class=\"language-text\">${{ github.ref }}</code>는 현재 브랜치를 의미한다. 이렇게 설정된 그룹 내에서는 한 번에 하나의 작업만 실행된다. 이를 통해 작업 간의 충돌을 방지하고 자원을 효율적으로 활용할 수 있다고 한다.</p>\n</li>\n<li>\n<p><strong>actions/cache@v3</strong><br>\n해당 코드는 Github의 캐시 서비스를 이용해서 종속성을 캐시한다. 캐시 서비스에 저장된 값은 동일 레포지토리 내에서 다른 워크플로우와 공유되기 때문에, 다음 번 워크프롤우에서 사용할 수 있다.</p>\n<ul>\n<li>\n<p><strong>path</strong><br>\n캐시를 저장할 디렉토리 경로를 지정한다.</p>\n</li>\n<li>\n<p><strong>key</strong><br>\n캐시를 식별하는 고유한 키를 생성한다. 위 코드에서는 두가지 변수를 사용한다. <code class=\"language-text\">${{ runner.os }}</code>는 실행 환경의 운영체제를, <code class=\"language-text\">-node-</code>는 단순 문자열, 그리고 <code class=\"language-text\">${{ hashFiles('**/package-lock.json') }}</code>은 package-lock.json 파일의 해시값을 의미한다. 이를 통해 package-lock.json 파일이 수정되었을 경우에만 새로운 캐시를 생성한다.</p>\n</li>\n<li>\n<p><strong>restore-keys</strong><br>\n캐시된 값을 복원할 때 사용할 키들의 목록을 지정한다. 위의 코드에서는 <code class=\"language-text\">${{ runner.os }}-node-</code>를 사용하여 앞선 <code class=\"language-text\">key</code>항목에서 생성되었던 모듴 키들을 순서대로 검사하도록 했다. 그 중 가장 최근에 생성된 캐시의 값으로 복원한다.</p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"참조\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참조</h1>\n<ul>\n<li><a href=\"https://docs.github.com/ko/pages/getting-started-with-github-pages/creating-a-github-pages-site\">Getting Started with Github Pages</a></li>\n<li><a href=\"https://pages.github.com/\">Github Pages</a></li>\n<li><a href=\"https://www.gatsbyjs.com/docs/how-to/previews-deploys-hosting/how-gatsby-works-with-github-pages/\">How Gatsby workswith Gitub Pages</a></li>\n<li><a href=\"https://github.com/peaceiris/actions-gh-pages\">peaceiris/actions-gh-pages</a></li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#1-%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C-%EB%B0%B0%ED%8F%AC%EB%9E%80\">1. 프론트엔드 배포란?</a></p>\n</li>\n<li>\n<p><a href=\"#2-github-pages\">2. GitHub Pages</a></p>\n<ul>\n<li><a href=\"#21-gh-pages\">2.1. gh-pages</a></li>\n<li><a href=\"#22-gatsby-and-gh-pages\">2.2. Gatsby and gh-pages</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-github-actions\">3. Github Actions</a></p>\n<ul>\n<li><a href=\"#31-peaceirisactions-gh-pages\">3.1. peaceiris/actions-gh-pages</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EC%A1%B0\">참조</a></p>\n</li>\n</ul>","frontmatter":{"createdAt":"2023-06-23","isCompleted":true,"reference":null,"title":"02. Gatsby 프로젝트 Github Pages 배포","updatedAt":"2023-06-23"}},"allMarkdownRemark":{"nodes":[{"id":"a30e0a72-b7c0-5421-8ea9-a3b8561b9f71","parent":{"id":"9a667cdd-77ae-5e05-a867-bb2669e3636e","name":"01_Gatsby","relativePath":"Gatsby/01_Gatsby.md"},"frontmatter":{"title":"01. Gatsby 렌더링 옵션과 프로젝트 구조","createdAt":"2023-06-16","updatedAt":"2023-06-16"},"excerpt":"시작하기 앞서... Gatsby로 Markdown기반의 블로그를 만들려고 한다면, Gatsby 공식문서를 보는 것을 추천한다. 맞춤형 강의라고 해도 믿을 만큼 잘 정리되어 있기 때문이다. 때문에 나는 앞으로 Gatsby…"},{"id":"cf0e5891-24f0-5538-92fd-24668355fe2f","parent":{"id":"188de855-c8ff-52fb-84e4-4cb46827f444","name":"02_Github_Pages","relativePath":"Gatsby/02_Github_Pages.md"},"frontmatter":{"title":"02. Gatsby 프로젝트 Github Pages 배포","createdAt":"2023-06-23","updatedAt":"2023-06-23"},"excerpt":"1. 프론트엔드 배포란? 프론트엔드 배포를 한 마디로 정리하면, 특정 url을 통한 GET요청에 대해 index.html…"},{"id":"8f011c7d-91c6-5495-9b0b-e670d72d2eb6","parent":{"id":"79dd15ac-f865-5d1b-a9f3-017e43758a0f","name":"03_Import_Settings","relativePath":"Gatsby/03_Import_Settings.md"},"frontmatter":{"title":"03. Gatsby 프로젝트(TypeScript) import 경로 설정","createdAt":"2023-06-24","updatedAt":"2023-06-24"},"excerpt":"1. import 경로 프로젝트를 진행하다 보면, import 절대경로를 설정하지 않을 수 없다.\n심지어 어쩌다가 한 번, IDE에서 자동 import…"}]}},"pageContext":{"pagePath":"posts/Gatsby/02_Github_Pages.md","regex":"/^(?!.*README).*Gatsby.*$/","id":"cf0e5891-24f0-5538-92fd-24668355fe2f","parent":{"id":"188de855-c8ff-52fb-84e4-4cb46827f444","name":"02_Github_Pages","relativeDirectory":"Gatsby","relativePath":"Gatsby/02_Github_Pages.md"}}},"staticQueryHashes":["3300660363","3571427910"],"slicesMap":{}}