{"componentChunkName":"component---src-templates-post-index-tsx","path":"/posts/Backend/Django/06_Django_QuerySet/","result":{"data":{"markdownRemark":{"id":"3a2ee22c-23db-53f4-8dec-93ac638a8eb6","html":"<ul>\n<li><a href=\"#1-queryset\">1. QuerySet</a>\n<ul>\n<li><a href=\"#11-query\">1.1. Query</a></li>\n<li><a href=\"#11-what-is-queryset\">1.1. What is QuerySet</a>\n<ul>\n<li><a href=\"#111-check-sql-query\">1.1.1. Check SQL Query</a></li>\n</ul>\n</li>\n<li><a href=\"#12-queryset-api\">1.2. QuerySet API</a></li>\n<li><a href=\"#13-queryset-evaluation-and-caching\">1.3. QuerySet Evaluation and Caching</a>\n<ul>\n<li><a href=\"#131-evaluation-and-caching\">1.3.1. Evaluation and Caching</a></li>\n<li><a href=\"#131-lazy-loading\">1.3.1. Lazy Loading</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#2-basic-crud\">2. Basic CRUD</a>\n<ul>\n<li><a href=\"#21-model\">2.1. Model</a></li>\n<li><a href=\"#22-create\">2.2. Create</a></li>\n<li><a href=\"#23-read\">2.3. Read</a>\n<ul>\n<li><a href=\"#231-values\">2.3.1. values()</a></li>\n<li><a href=\"#232-values_list\">2.3.2. values_list()</a></li>\n</ul>\n</li>\n<li><a href=\"#24-update\">2.4. Update</a></li>\n<li><a href=\"#25-delete\">2.5. Delete</a></li>\n</ul>\n</li>\n<li><a href=\"#2-sort-data\">2. Sort Data</a></li>\n<li><a href=\"#3-filter-data\">3. Filter Data</a></li>\n<li><a href=\"#4-group-data\">4. Group Data</a>\n<ul>\n<li><a href=\"#41-aggregation\">4.1. Aggregation</a></li>\n<li><a href=\"#42-annotation\">4.2. Annotation</a></li>\n<li><a href=\"#421-annotation-in-n1\">4.2.1. Annotation In N:1</a></li>\n</ul>\n</li>\n<li><a href=\"#6-query-optimization\">6. Query Optimization</a>\n<ul>\n<li><a href=\"#61-annotate\">6.1. annotate</a></li>\n<li><a href=\"#62-selected_related\">6.2. selected_related()</a></li>\n<li><a href=\"#63-prefetch_related\">6.3. prefetch_related()</a></li>\n<li><a href=\"#64-prefetch\">6.4. Prefetch()</a></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1 id=\"1-queryset\" style=\"position:relative;\"><a href=\"#1-queryset\" aria-label=\"1 queryset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. QuerySet</h1>\n<h2 id=\"11-query\" style=\"position:relative;\"><a href=\"#11-query\" aria-label=\"11 query permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.1. Query</h2>\n<p>A query is <strong>a request for data from a database.</strong></p>\n<h2 id=\"11-what-is-queryset\" style=\"position:relative;\"><a href=\"#11-what-is-queryset\" aria-label=\"11 what is queryset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.1. What is QuerySet</h2>\n<p><del>A QuerySet represents <strong>a collection of objects from your database.</strong></del></p>\n<p><a href=\"https://github.com/django/django/blob/main/django/db/models/query.py#L291\">Github django.db.models.query QuerySet</a></p>\n<p>QuerySet consists of <strong>one query</strong> and <strong>several query sets.</strong><br>\n<mark>Therefore, QuerySet can be considered query.</mark></p>\n<p>The reason why QuerySet works like a collection of objects is because QuerySet <a href=\"#13-queryset-evaluation-and-caching\">caches data.</a></p>\n<h3 id=\"111-check-sql-query\" style=\"position:relative;\"><a href=\"#111-check-sql-query\" aria-label=\"111 check sql query permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.1.1. Check SQL Query</h3>\n<p>You can check the SQL query by checking <code>query</code> attribute of QuerySet</p>\n<pre><code class=\"language-python\">queryset = MyModel.objects.all()\nprint(queryset.query)\n</code></pre>\n<h2 id=\"12-queryset-api\" style=\"position:relative;\"><a href=\"#12-queryset-api\" aria-label=\"12 queryset api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.2. QuerySet API</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; margin-bottom: 20px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/70eb324b17c14130fecace8b0dd400a6/faa66/ORM.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB0JxzTE//xAAYEAEAAwEAAAAAAAAAAAAAAAACARETEv/aAAgBAQABBQImYT7zO1f/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAREx/9oACAEDAQE/AYxT/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/Aa1//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAExEUH/2gAIAQEABj8C6PKRn//EABoQAAIDAQEAAAAAAAAAAAAAAAABESFBMWH/2gAIAQEAAT8hXXFfS7m8LR3471n/2gAMAwEAAgADAAAAEH/v/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EJMP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAgEBPxBd2Xf/xAAcEAEAAQQDAAAAAAAAAAAAAAABEQAhMUFRccH/2gAIAQEAAT8QS98rLTfLUQsMStpbvNMWJgQe1//Z'); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/TIL/static/70eb324b17c14130fecace8b0dd400a6/c54d4/ORM.webp 175w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/a3432/ORM.webp 350w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/426ac/ORM.webp 700w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/c139f/ORM.webp 1050w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/663aa/ORM.webp 1056w\" sizes=\"(max-width: 700px) 100vw, 700px\" type=\"image/webp\">\n          <source srcset=\"/TIL/static/70eb324b17c14130fecace8b0dd400a6/e52aa/ORM.jpg 175w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/70ebb/ORM.jpg 350w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/29d31/ORM.jpg 700w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/9ecec/ORM.jpg 1050w,\n/TIL/static/70eb324b17c14130fecace8b0dd400a6/faa66/ORM.jpg 1056w\" sizes=\"(max-width: 700px) 100vw, 700px\" type=\"image/jpeg\">\n          <img class=\"gatsby-resp-image-image\" src=\"/TIL/static/70eb324b17c14130fecace8b0dd400a6/29d31/ORM.jpg\" alt=\"ORM\" title=\"\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span>\n<p><strong>QuerySet API is the method that can make queries(QuerySet).</strong></p>\n<p>Once you’ve created your data models, Django automatically gives you a database-abstraction API that lets you create, retrieve, update and delete objects.</p>\n<h2 id=\"13-queryset-evaluation-and-caching\" style=\"position:relative;\"><a href=\"#13-queryset-evaluation-and-caching\" aria-label=\"13 queryset evaluation and caching permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.3. QuerySet Evaluation and Caching</h2>\n<h3 id=\"131-evaluation-and-caching\" style=\"position:relative;\"><a href=\"#131-evaluation-and-caching\" aria-label=\"131 evaluation and caching permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.3.1. Evaluation and Caching</h3>\n<p>When QuerySets are evaluated, queries actually <strong>hit the database</strong>, and <strong>the result is cached(saved)</strong> in <code>self._result_cache</code>.</p>\n<p>Internally, a QuerySet can be constructed, filtered, sliced, and generally passed around without actually hitting the database. No database activity actually occurs until you do something to evaluate the queryset.</p>\n<h3 id=\"131-lazy-loading\" style=\"position:relative;\"><a href=\"#131-lazy-loading\" aria-label=\"131 lazy loading permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.3.1. Lazy Loading</h3>\n<ul>\n<li><strong>Iteration</strong>\n<ul>\n<li>A QuerySet is iterable, and it executes its database query the first time you iterate over it.\n<pre><code class=\"language-python\">for e in Entry.objects.all():\nprint(e.headline)\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>Asynchronous iteration</strong></p>\n<ul>\n<li>\n<p>A QuerySet can also be iterated over using async for:</p>\n<pre><code class=\"language-python\">async for e in Entry.objects.all():\nresults.append(e)\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Slicing with Step</strong></p>\n<ul>\n<li>\n<p>As explained in Limiting QuerySets, a QuerySet can be sliced, using Python’s array-slicing syntax. <strong>Slicing an unevaluated QuerySet usually returns another unevaluated QuerySet</strong>, but Django will execute the database query <strong>if you use the “step” parameter of slice syntax, and will return a list.</strong> Slicing a QuerySet that has been evaluated also returns a list.</p>\n</li>\n<li>\n<p>Also note that even though slicing an unevaluated QuerySet returns another unevaluated QuerySet, <mark>modifying the returned unevalutaed QuerySet further (e.g., adding more filters, or modifying ordering) is not allowed,</mark> since that does not translate well into SQL and it would not have a clear meaning either.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Pickling</strong></p>\n<ul>\n<li>\n<p><strong>If you pickle a QuerySet, this will force all the results to be loaded into memory prior to pickling.</strong> Pickling is usually used as a precursor to caching and when the cached queryset is reloaded, you want the results to already be present and ready for use (reading from the database can take some time, defeating the purpose of caching). This means that when you unpickle a QuerySet, it contains the results at the moment it was pickled, rather than the results that are currently in the database.</p>\n</li>\n<li>\n<p>If you only want to pickle the necessary information to recreate the QuerySet from the database at a later time, <strong>pickle the query attribute of the QuerySet.</strong></p>\n<pre><code class=\"language-python\">import pickle\nquery = pickle.loads(s)     # Assuming 's' is the pickled string.\nqs = MyModel.objects.all()\nqs.query = query\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>repr()</strong></p>\n<ul>\n<li>A QuerySet is evaluated when you call repr() on it. This is for convenience in the Python interactive interpreter, so you can immediately see your results when using the API interactively.</li>\n</ul>\n</li>\n<li>\n<p><strong>len()</strong></p>\n<ul>\n<li>A QuerySet is evaluated when you call len() on it. This, as you might expect, returns the length of the result list.</li>\n</ul>\n<ul>\n<li>If you only need to determine the number of records in the set (and don’t need the actual objects), <mark>it’s much more efficient to use <code>QuerySet.count</code>.</mark></li>\n</ul>\n</li>\n<li>\n<p><strong>list()</strong></p>\n<ul>\n<li>Force evaluation of a QuerySet by calling list() on it. For example:</li>\n</ul>\n</li>\n<li>\n<p><strong>bool()</strong></p>\n<ul>\n<li>Testing a QuerySet in a boolean context, such as using bool(), or, and or an if statement, will cause the query to be executed. If there is at least one result, the QuerySet is True, otherwise False.</li>\n</ul>\n<ul>\n<li>\n<p>If you only want to determine if at least one result exists (and don’t need the actual objects), <mark>it’s more efficient to use exists().</mark></p>\n<pre><code class=\"language-python\">if Entry.objects.filter(headline=\"Test\").exists():\nprint(\"There is at least one Entry with the headline Test\")\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"2-basic-crud\" style=\"position:relative;\"><a href=\"#2-basic-crud\" aria-label=\"2 basic crud permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Basic CRUD</h1>\n<h2 id=\"21-model\" style=\"position:relative;\"><a href=\"#21-model\" aria-label=\"21 model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.1. Model</h2>\n<pre><code class=\"language-python\">from django.db import models\n\nclass User(models.Model):\n    first_name = models.CharField(max_length=15)\n    last_name = models.CharField(max_length=20)\n    age = models.IntegerField()\n    country = models.CharField(max_length=20)\n    phone = models.CharField(max_length=20)\n    balance = models.IntegerField()\n</code></pre>\n<h2 id=\"22-create\" style=\"position:relative;\"><a href=\"#22-create\" aria-label=\"22 create permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.2. Create</h2>\n<p><code>User.objects.create(first_name='Kim', last_name='Soo', ...)</code></p>\n<h2 id=\"23-read\" style=\"position:relative;\"><a href=\"#23-read\" aria-label=\"23 read permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.3. Read</h2>\n<p><strong>Read all the records</strong></p>\n<p><code>User.objects.all()</code></p>\n<p><strong>Read the 101th record</strong></p>\n<p><code>User.objects.get(pk=101)</code></p>\n<h3 id=\"231-values\" style=\"position:relative;\"><a href=\"#231-values\" aria-label=\"231 values permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.3.1. values()</h3>\n<p><strong>Returns a list of dictionaries</strong> which keys are the field name and the value is the data. It gets the field name you want to represent as parameters.</p>\n<pre><code class=\"language-python\">User.objects.values()\nUser.objects.values('name').filter(id__lt=8)\n</code></pre>\n<h3 id=\"232-values_list\" style=\"position:relative;\"><a href=\"#232-values_list\" aria-label=\"232 values_list permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.3.2. values_list()</h3>\n<p><strong>Returns a list of tuples</strong> which elements are the data. It gets the field name you want to represent as parameters.</p>\n<pre><code class=\"language-python\">User.objects.values_list()\nUser.objects.values_list('name').filter(id__lt=8)\n</code></pre>\n<h2 id=\"24-update\" style=\"position:relative;\"><a href=\"#24-update\" aria-label=\"24 update permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.4. Update</h2>\n<p><strong>Update the 101th record's last_name into 'Kim'</strong></p>\n<pre><code class=\"language-python\">  user = User.objects.get(pk=101)\n  user.last_name='Kim'\n  user.save()\n</code></pre>\n<h2 id=\"25-delete\" style=\"position:relative;\"><a href=\"#25-delete\" aria-label=\"25 delete permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.5. Delete</h2>\n<p><strong>Delete the 101the record</strong></p>\n<pre><code class=\"language-python\">user = User.objects.get(pk-101)\nuser.delete()\n</code></pre>\n<h1 id=\"2-sort-data\" style=\"position:relative;\"><a href=\"#2-sort-data\" aria-label=\"2 sort data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Sort Data</h1>\n<p><strong>order_by()</strong></p>\n<ul>\n<li>Sort in ascending order, in the order of field names received as parameters.</li>\n<li>To sort in descending order, put '-'' before the field name.</li>\n<li>To sort in random, put '?' as a parameter.</li>\n</ul>\n<ul>\n<li><strong>Read first_name and age in order of age</strong>\n<ul>\n<li><code>User.objects.order_by('age').values('first_name', 'age')</code></li>\n</ul>\n</li>\n<li><strong>Read all the fields in order of age</strong>\n<ul>\n<li><code>User.objects.order_by('age').values()</code></li>\n</ul>\n</li>\n<li><strong>Read first_name and age in reverse order of age</strong>\n<ul>\n<li><code>User.objects.order_by('-age').values('first_name', 'age')</code></li>\n</ul>\n</li>\n<li><strong>Read first_name and age in random order</strong>\n<ul>\n<li><code>User.objects.order_by('?').values('first_name', 'age')</code></li>\n</ul>\n</li>\n<li><strong>Read first_name in order of age. If the age is the same, sort in reverse ordef of account_balance</strong>\n<ul>\n<li><code>User.objects.order_by('age', '-balance').values('first_name')</code></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"3-filter-data\" style=\"position:relative;\"><a href=\"#3-filter-data\" aria-label=\"3 filter data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Filter Data</h1>\n<p><a href=\"https://docs.djangoproject.com/en/4.1/ref/models/querysets/\">Django_Filter_Lookups</a></p>\n<p><strong>distinct()</strong></p>\n<ul>\n<li><strong>Read all the countries without duplication</strong>\n<ul>\n<li><code>User.objects.distinct().values('country')</code></li>\n</ul>\n</li>\n<li><strong>Read all the countries without duplication inf order of country</strong>\n<ul>\n<li><code>User.objects.distinct().values('country').order_by('country')</code></li>\n</ul>\n</li>\n</ul>\n<p><strong>gte, gt</strong></p>\n<ul>\n<li><strong>Read first_name with age == 30</strong>\n<ul>\n<li><code>User.obejcts.filter(age=30).values('first_name')</code></li>\n</ul>\n</li>\n<li><strong>Read first_name with age >= 30</strong>\n<ul>\n<li><code>User.obejcts.filter(age__gte=30).values('first_name')</code></li>\n</ul>\n</li>\n<li><strong>Read first_name with age >= 30 and balance > 50</strong>\n<ul>\n<li><code>User.obejcts.filter(age__gte=30, balance__gt=50).values('first_name')</code></li>\n<li><code>from django.db.models import Q</code></li>\n<li><code>User.objects.filter(Q(age__gte=30) &#x26; Q(balance__gt=50))</code></li>\n</ul>\n</li>\n</ul>\n<p><strong>contains, startswith, endswith</strong></p>\n<ul>\n<li><strong>Read first_name which contains 'A'</strong>\n<ul>\n<li><code>User.obejcts.filter(first_name__contains='A').values('first_name')</code></li>\n</ul>\n</li>\n<li><strong>Read phone which starts with '011'</strong>\n<ul>\n<li><code>User.obejcts.filter(phone__startswiths='011-').values('phone')</code></li>\n</ul>\n</li>\n<li><strong>Read phone which endswith with '9'</strong>\n<ul>\n<li><code>User.obejcts.filter(phone__endswith='9').values('phone')</code></li>\n</ul>\n</li>\n</ul>\n<p><strong>in</strong></p>\n<ul>\n<li><strong>Read first_name of people who live in Korea or America</strong>\n<ul>\n<li><code>User.obejcts.filter(country__in=['Korea, 'America'']).values('first_name')</code></li>\n</ul>\n</li>\n<li><strong>Read first_name of people who don't live in Korea or America</strong>\n<ul>\n<li><code>User.obejcts.exclude(country__in=['Korea, 'America'']).values('first_name')</code></li>\n</ul>\n</li>\n</ul>\n<p><strong>slicing</strong></p>\n<ul>\n<li>\n<p>Read first_name of the 10 yougest people</p>\n<ul>\n<li><code>User.obejcts.order_by('age').values('first_name')[:10]</code></li>\n</ul>\n</li>\n</ul>\n<p><strong>Q</strong></p>\n<ul>\n<li>Read first_name of people 'whose age is 30' or 'whose the last_name is 'Kim''\n<ul>\n<li>\n<pre><code class=\"language-python\">from django.db.models import Q`\nUser.objects.filter(Q(age=30) | Q(last_name='Kim'))\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"4-group-data\" style=\"position:relative;\"><a href=\"#4-group-data\" aria-label=\"4 group data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Group Data</h1>\n<h2 id=\"41-aggregation\" style=\"position:relative;\"><a href=\"#41-aggregation\" aria-label=\"41 aggregation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.1. Aggregation</h2>\n<p><a href=\"https://docs.djangoproject.com/en/4.1/topics/db/aggregation/\">Django_Aggregation</a></p>\n<p><code>from django.db.models import function_name</code></p>\n<ul>\n<li>\n<p>It returns a dictionary which key is <code>'ParameterName\\_\\_FunctionName'</code>. The name of the key can be set.</p>\n<pre><code class=\"language-python\">User.objects.filter(age__gte=30).aggregate(Avg('avg'))\n# {'age__avg': 36.25}\nUser.objects.filter(age__gte=30).aggregate(average=Avg('avg'))\n# {'average': 36.25}\n</code></pre>\n</li>\n<li>\n<p><strong>Read the largest balance</strong></p>\n<ul>\n<li><code>User.objects.aggregate(Max('balance'))</code></li>\n</ul>\n</li>\n<li>\n<p><strong>Read the sum of balance</strong></p>\n<ul>\n<li><code>User.objects.aggregate(Sum('balance'))</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"42-annotation\" style=\"position:relative;\"><a href=\"#42-annotation\" aria-label=\"42 annotation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.2. Annotation</h2>\n<p><strong>Add an additional columm for the records grouped by values()</strong></p>\n<ul>\n<li><strong>Read the number of people in each country</strong>\n<ul>\n<li><code>User.objects.values('country').annotate(Count('country'))</code></li>\n</ul>\n</li>\n<li><strong>Read the number of people and the average of balance in each country</strong>\n<ul>\n<li><code>User.objects.values('country').annotate(Count('country'), avg_balance=Avg('balance'))</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"421-annotation-in-n1\" style=\"position:relative;\"><a href=\"#421-annotation-in-n1\" aria-label=\"421 annotation in n1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.2.1. Annotation In N:1</h2>\n<p><strong>Example 1</strong></p>\n<ul>\n<li>\n<p><strong>The relationship between comments and articles is N:1.</strong></p>\n<pre><code class=\"language-python\"># N : 1 = Comment : Article\nArticle.objects.annotate(\n    number_of_comment=Count('comment'),\n    number_of_recent_comment=Count('comment', filter=Q(comment__created_at__lte='2000-01-01'))\n)\n</code></pre>\n<ul>\n<li>The parameter 'comment' is <strong>not related_name</strong>, but <strong>model_name</strong></li>\n</ul>\n</li>\n</ul>\n<p><strong>Example 2</strong></p>\n<ul>\n<li>\n<p>models.py</p>\n<pre><code class=\"language-python\">class Question(models.Model):\n    title = models.CharField(max_length=50)\n    issue_a = models.CharField(max_length=50)\n    issue_b = models.CharField(max_length=50)\n\nclass Comment(models.Model):\n    question = models.ForeignKey(Question, on_delete=models.CASCADE)\n    content = models.CharField(max_length=100)\n    pick = models.BooleanField()\n</code></pre>\n</li>\n<li>\n<p>forms.py</p>\n<pre><code class=\"language-python\">class CommentForm(forms.ModelForm):\n    PICK_A = False\n    PICK_B = True\n    PICKS = [\n        (PICK_A, '왼쪽'),\n        (PICK_B, '오른쪽'),\n    ]\n    pick = forms.ChoiceField(choices=PICKS)\n\n    class Meta:\n        model = Comment\n        fields = '__all__'\n</code></pre>\n</li>\n<li>\n<p>views.py</p>\n<pre><code class=\"language-python\">def detail(request, question_pk):\n    count_a = Count('comment', filter=Q(comment__pick=False))\n    count_b = Count('comment', filter=Q(comment__pick=True))\n    total_count = Count('comment')\n\n    question = Question.objects.annotate(\n        count_a = count_a,\n        count_b = count_b,\n        totla_count = total_count,\n    ).get(pk=questioin_pk)\n\n    question.count_a # 왼쪽을 선택한 코멘트 갯수\n    question.count_b # 오른을 선택한 코멘트 갯수\n</code></pre>\n</li>\n</ul>\n<h1 id=\"6-query-optimization\" style=\"position:relative;\"><a href=\"#6-query-optimization\" aria-label=\"6 query optimization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. Query Optimization</h1>\n<p><strong>References</strong></p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=EZgLfDrUlrk\">Pycon 2020 QuerySet</a></li>\n<li><a href=\"https://leffept.tistory.com/316\">블로그 글</a></li>\n</ul>\n<p><strong>Table Relations</strong></p>\n<ul>\n<li>1:N (Article-Comment)</li>\n<li>1:N (User-Article)</li>\n<li>1:N (User-Comment)</li>\n</ul>\n<h2 id=\"61-annotate\" style=\"position:relative;\"><a href=\"#61-annotate\" aria-label=\"61 annotate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6.1. annotate</h2>\n<ul>\n<li>\n<p><strong>Display the number of comments for each article in the index_1.html</strong></p>\n<pre><code class=\"language-python\">def index_1(request):\n    articles = Article.objects.annotate(Count('comment')).order_by('-pk')\n    context = {\n        'articles': articles,\n    }\n    return render(request, 'articles/index_1.html', context)\n</code></pre>\n</li>\n</ul>\n<h2 id=\"62-selected_related\" style=\"position:relative;\"><a href=\"#62-selected_related\" aria-label=\"62 selected_related permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6.2. selected_related()</h2>\n<ul>\n<li><strong>select_related(*fields)</strong>\nMake <code>INNER JOIN</code> query for the field which is ForeignKey or OneToOneField relation.</li>\n</ul>\n<ul>\n<li>\n<p><strong>Display the username for each article in the index_2.html</strong></p>\n<pre><code class=\"language-python\">def index_2(request):\n    articles = Article.objects.select_related('user').order_by('-pk')\n    context = {\n        'articles': articles,\n    }\n    return render(request, 'articles/index_2.html', context)\n</code></pre>\n</li>\n</ul>\n<h2 id=\"63-prefetch_related\" style=\"position:relative;\"><a href=\"#63-prefetch_related\" aria-label=\"63 prefetch_related permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6.3. prefetch_related()</h2>\n<ul>\n<li><strong>prefetch_related(*lookups)</strong>\nMake other QuerySets for the lookup which are ManytoManyField OneToMany dereference relation.</li>\n</ul>\n<ul>\n<li>\n<p><strong>Display all the comments for each article in the index_3.html</strong></p>\n<pre><code class=\"language-python\">def index_3(request):\n    articles = Article.objects.prefetch_related('comment_set').order_by('-pk')\n    context = {\n        'articles': articles,\n    }\n    return render(request, 'articles/index_3.html', context)\n</code></pre>\n</li>\n</ul>\n<h2 id=\"64-prefetch\" style=\"position:relative;\"><a href=\"#64-prefetch\" aria-label=\"64 prefetch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6.4. Prefetch()</h2>\n<ul>\n<li><strong>Prefetch(lookup, queryset=None, to_attr=None)¶</strong>\n<ul>\n<li>The Prefetch() object can be used to control the operation of prefetch_related().</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>\n<p><strong>Display the author and all the comments for each article in the index_4.html</strong></p>\n<pre><code class=\"language-python\">def index_4(request):\n    articles = Article.objects.prefetch_related(\n        Prefetch('comment_set', queryset=Comment.objects.select_related('user'))\n    ).order_by('-pk')\n    context = {\n        'articles': articles,\n    }\n    return render(request, 'articles/index_4.html', context)\n</code></pre>\n</li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#1-queryset\">1. QuerySet</a></p>\n<ul>\n<li>\n<p><a href=\"#11-query\">1.1. Query</a></p>\n</li>\n<li>\n<p><a href=\"#11-what-is-queryset\">1.1. What is QuerySet</a></p>\n<ul>\n<li><a href=\"#111-check-sql-query\">1.1.1. Check SQL Query</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#12-queryset-api\">1.2. QuerySet API</a></p>\n</li>\n<li>\n<p><a href=\"#13-queryset-evaluation-and-caching\">1.3. QuerySet Evaluation and Caching</a></p>\n<ul>\n<li><a href=\"#131-evaluation-and-caching\">1.3.1. Evaluation and Caching</a></li>\n<li><a href=\"#131-lazy-loading\">1.3.1. Lazy Loading</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-basic-crud\">2. Basic CRUD</a></p>\n<ul>\n<li>\n<p><a href=\"#21-model\">2.1. Model</a></p>\n</li>\n<li>\n<p><a href=\"#22-create\">2.2. Create</a></p>\n</li>\n<li>\n<p><a href=\"#23-read\">2.3. Read</a></p>\n<ul>\n<li><a href=\"#231-values\">2.3.1. values()</a></li>\n<li><a href=\"#232-values_list\">2.3.2. values_list()</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#24-update\">2.4. Update</a></p>\n</li>\n<li>\n<p><a href=\"#25-delete\">2.5. Delete</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-sort-data\">2. Sort Data</a></p>\n</li>\n<li>\n<p><a href=\"#3-filter-data\">3. Filter Data</a></p>\n</li>\n<li>\n<p><a href=\"#4-group-data\">4. Group Data</a></p>\n<ul>\n<li><a href=\"#41-aggregation\">4.1. Aggregation</a></li>\n<li><a href=\"#42-annotation\">4.2. Annotation</a></li>\n<li><a href=\"#421-annotation-in-n1\">4.2.1. Annotation In N:1</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#6-query-optimization\">6. Query Optimization</a></p>\n<ul>\n<li><a href=\"#61-annotate\">6.1. annotate</a></li>\n<li><a href=\"#62-selected_related\">6.2. selected_related()</a></li>\n<li><a href=\"#63-prefetch_related\">6.3. prefetch_related()</a></li>\n<li><a href=\"#64-prefetch\">6.4. Prefetch()</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Django QuerySet","createdAt":"2022-12-24","updatedAt":"2022-12-25","tags":null,"description":null,"reference":null}},"allMarkdownRemark":{"nodes":[{"id":"64fe3ac3-9ec7-5057-b5cf-209ab5b38218","excerpt":"0. Cross Site Request Forgery(CSRF) 0.1. What is CSRF 0.2. CSRF Token 1. Model 1.1. models.py 2. Create 2.1. urls.py 2.2. views.py 2.…","parent":{"id":"b60ef590-337d-5fbc-ac3c-465bb644314e","name":"02_Django_CRUD","relativePath":"Backend/Django/02_Django_CRUD.md"},"frontmatter":{"title":"Django Basic CRUD","createdAt":"2022-11-08","updatedAt":"2022-12-24"},"fields":{"slug":"/posts/Backend/Django/02_Django_CRUD/"}},{"id":"f0b570c2-7aa3-5406-b3ed-5e4c7e6b403f","excerpt":"1. Model Form 1.1. Model Class 1.2. Form Class 1.3. ModeForm Class 2. Create 2.1. urls.py 2.2. views.py 2.3. templates.html 3. Read 3.…","parent":{"id":"4381f074-5ff2-5dfe-b751-1022d9d9f64c","name":"03_Django_CRUD_ModelForm","relativePath":"Backend/Django/03_Django_CRUD_ModelForm.md"},"frontmatter":{"title":"Django CRUD with Model Form","createdAt":"2022-11-08","updatedAt":"2022-12-24"},"fields":{"slug":"/posts/Backend/Django/03_Django_CRUD_ModelForm/"}},{"id":"2ceb5c6e-b5b1-5193-a1e5-f7a749ec9d9c","excerpt":"1. Fixtures 1.1. The Definition of Fixtures 1.2. The Default Path of Fixtures 1.3. Create Fixtures 1.4. Import Fixtures 1. Fixtures How to…","parent":{"id":"955390a3-0b4e-5e5e-8cbd-ce910a67d06a","name":"10_Django_Fixtures","relativePath":"Backend/Django/10_Django_Fixtures.md"},"frontmatter":{"title":"Django Fixtures","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"fields":{"slug":"/posts/Backend/Django/10_Django_Fixtures/"}},{"id":"040f5a80-2e15-5109-bf84-5e6b71ad4657","excerpt":"1. Many to One Relationship 1.1. Foreign Key 2. Comment : Article (N:1) 2.1. Create 2.2. Read 2.3. Delete 3. Article : User (N:1) 3.…","parent":{"id":"e4d09ce7-8429-558f-854b-88c647667db3","name":"07_Django_Many_to_One","relativePath":"Backend/Django/07_Django_Many_to_One.md"},"frontmatter":{"title":"Django N:1 Realationship","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"fields":{"slug":"/posts/Backend/Django/07_Django_Many_to_One/"}},{"id":"caac3b53-95e0-5573-b4b1-0fff44f462d2","excerpt":"1. Intro 1.1. Terms 1.2. The limits of N:1 Relationship 1.3. Intermediary Model 1.4. Many To Many Field 1.5. Many To Many Table 1.6. with…","parent":{"id":"a18f7611-d467-5606-863c-845e9beab7d9","name":"08_Django_Many_to_Many","relativePath":"Backend/Django/08_Django_Many_to_Many.md"},"frontmatter":{"title":"Django N:M Realationship","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"fields":{"slug":"/posts/Backend/Django/08_Django_Many_to_Many/"}},{"id":"d9cb8064-70f5-510a-970b-b24c6ac5e394","excerpt":"1. HTTP 1.1. HTTP 정의 1.2. HTTP의 특징 1.3. HTTP Request Methods 1.3. HTTP Response Status Code 1.4. URI(Uniform Resource Indentifier) 1.5. URL…","parent":{"id":"af752c25-7364-5944-ae08-73a796a8712a","name":"11_Django_REST_API","relativePath":"Backend/Django/11_Django_REST_API.md"},"frontmatter":{"title":"Django REST API","createdAt":"2022-11-08","updatedAt":"2022-12-28"},"fields":{"slug":"/posts/Backend/Django/11_Django_REST_API/"}},{"id":"e4c8a797-8a3b-52bb-a234-c26e492b1401","excerpt":"1. Static Files 1.1. Static Files 1.2. Static Files with Django 1.3. Deploy Static Files 1.3.1. STATIC_ROOT 1.3.2. Procedure 2. Media Files…","parent":{"id":"688a0874-9671-5c95-b4b7-968e254af6fc","name":"09_Django_Static_Media","relativePath":"Backend/Django/09_Django_Static_Media.md"},"frontmatter":{"title":"Django Static Files","createdAt":"2022-11-08","updatedAt":"2022-12-27"},"fields":{"slug":"/posts/Backend/Django/09_Django_Static_Media/"}},{"id":"20c8e53f-b1bb-519c-8683-ea0afda9e0f7","excerpt":"1. Django 1.1. Framework 1.2. Django 2. MTV Design Pattern 2.1. Design Pattern 2.2. MTV Design Pattern 3. Start Django 4. Django Folder…","parent":{"id":"318dafb0-b115-581e-8c4d-591d52550c0b","name":"01_Django_Basics_MTV","relativePath":"Backend/Django/01_Django_Basics_MTV.md"},"frontmatter":{"title":"Django Basics & MTV Design Pattern","createdAt":"2022-12-24","updatedAt":"2022-12-24"},"fields":{"slug":"/posts/Backend/Django/01_Django_Basics_MTV/"}},{"id":"9574434a-4495-56c8-9640-5aeadb7128d9","excerpt":"1. Overview 1.1. Authentication 1.2. Authorization 1.3. accounts App 2. Custom User Model 2.1. User Model 2.2. Custom User Model 2.3. User…","parent":{"id":"268fc07e-bdb0-532f-9d53-80eaba647676","name":"04_Django_Authentication","relativePath":"Backend/Django/04_Django_Authentication.md"},"frontmatter":{"title":"Django Internal Authentication","createdAt":"2022-12-24","updatedAt":"2023-01-02"},"fields":{"slug":"/posts/Backend/Django/04_Django_Authentication/"}},{"id":"3a2ee22c-23db-53f4-8dec-93ac638a8eb6","excerpt":"1. QuerySet 1.1. Query 1.1. What is QuerySet 1.1.1. Check SQL Query 1.2. QuerySet API 1.3. QuerySet Evaluation and Caching 1.3.1. Evaluation…","parent":{"id":"e4db1fdd-48ab-522a-addc-f1db7b1effaa","name":"06_Django_QuerySet","relativePath":"Backend/Django/06_Django_QuerySet.md"},"frontmatter":{"title":"Django QuerySet","createdAt":"2022-12-24","updatedAt":"2022-12-25"},"fields":{"slug":"/posts/Backend/Django/06_Django_QuerySet/"}},{"id":"1f86280a-2c23-53ff-af3d-c1ed6d223cab","excerpt":"1. Database 1.1. RDB 1.2. Structure 2. SQL 2.1. SQL 2.2. Types of SQL Commands 2.3. SQL Syntax 2.4. Import .csv to Table 3. DDL 3.1. CREATE…","parent":{"id":"83db0b1c-e3f7-5201-8706-1cbbf4b61c7a","name":"05_SQLite3_SQL","relativePath":"Backend/Django/05_SQLite3_SQL.md"},"frontmatter":{"title":"SQL Basics","createdAt":"2022-12-28","updatedAt":"2022-12-28"},"fields":{"slug":"/posts/Backend/Django/05_SQLite3_SQL/"}},{"id":"564ce658-4880-550f-ae36-5b903fb66632","excerpt":"1. CORS 1.1. Same Origin Policy 1.2. Definition of Origin 1.3. CORS 1.3.1. django-cors-headers 2. Authentication 2.1. Authentication Class…","parent":{"id":"0bc65511-c15f-5f37-9355-27e5d252a113","name":"12_Django_REST_Authentication","relativePath":"Backend/Django/12_Django_REST_Authentication.md"},"frontmatter":{"title":"Django REST Authentication","createdAt":"2023-01-02","updatedAt":"2023-01-12"},"fields":{"slug":"/posts/Backend/Django/12_Django_REST_Authentication/"}},{"id":"9857f9dd-0697-539f-8198-21540502b6d0","excerpt":"1. 개요 2. 설치 2.1. Linux 3. 사용자 설정 3.1. Linux 3.1.1. ACL 조회 3.1.2. ACL 수정 4. Django 4.1. Django 4.0 이상 4.2. Django 4.0 미만 1. 개요 Redis는 in…","parent":{"id":"d5744a7e-d576-5af7-9c0d-60a8ec5df625","name":"Redis","relativePath":"Backend/Django/Redis.md"},"frontmatter":{"title":"Redis Basics","createdAt":"2023-04-28","updatedAt":"2023-05-01"},"fields":{"slug":"/posts/Backend/Django/Redis/"}}]}},"pageContext":{"pagePath":"/posts/Backend/Django/06_Django_QuerySet/","siblingPostsPathRegex":"/^(?!.*README).*Backend\\/Django\\/.*$/","relativeDirectory":"Django","id":"3a2ee22c-23db-53f4-8dec-93ac638a8eb6","parent":{"id":"e4db1fdd-48ab-522a-addc-f1db7b1effaa","name":"06_Django_QuerySet","relativePath":"Backend/Django/06_Django_QuerySet.md"},"fields":{"slug":"/posts/Backend/Django/06_Django_QuerySet/"}}},"staticQueryHashes":["24302420","4059933791"],"slicesMap":{}}