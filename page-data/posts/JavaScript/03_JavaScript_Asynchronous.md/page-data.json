{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/JavaScript/03_JavaScript_Asynchronous.md/","result":{"data":{"markdownRemark":{"id":"8f8aefed-d02a-5b7a-8a11-75e5d376c5b2","html":"<h1>JavaScript Asynchronous</h1>\n<h2>Index</h2>\n<ul>\n<li><a href=\"#1-synchronous-and-asynchronous\">1. Synchronous and Asynchronous</a>\n<ul>\n<li><a href=\"#11-asynchronous-javascript\">1.1. Asynchronous JavaScript</a></li>\n<li><a href=\"#12-javascript-runtime\">1.2. JavaScript Runtime</a></li>\n</ul>\n</li>\n<li><a href=\"#2-axios\">2. Axios</a>\n<ul>\n<li><a href=\"#21-the-structure-of-axios\">2.1. The Structure of Axios</a></li>\n<li><a href=\"#22-promise\">2.2. Promise</a></li>\n<li><a href=\"#22-promise-and-await\">2.2. Promise and Await</a></li>\n</ul>\n</li>\n<li><a href=\"#3-ajax\">3. AJAX</a>\n<ul>\n<li><a href=\"#31-ajax\">3.1. AJAX</a></li>\n<li><a href=\"#32-data--attribute\">3.2. data-* attribute</a></li>\n<li><a href=\"#33-example-with-django\">3.3. Example with Django</a>\n<ul>\n<li><a href=\"#331-follow\">3.3.1. Follow</a></li>\n<li><a href=\"#332-like\">3.3.2. Like</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1>1. Synchronous and Asynchronous</h1>\n<p><strong>Synchronous</strong></p>\n<ul>\n<li>Process in order</li>\n<li>Wait for the response to a request.</li>\n</ul>\n<p><strong>Asynchronous</strong></p>\n<ul>\n<li>Process in parallel</li>\n<li>Don't Wait for the response -> Better user experience</li>\n</ul>\n<h2>1.1. Asynchronous JavaScript</h2>\n<p>JavaScript is a single-thread language, but it still can handle things asynchronously.</p>\n<pre><code class=\"language-javascript\">function slowRequest(callBack) {\r\n  console.log('1. A long time process started')\r\n  setTimeout(function () {\r\n    callBack()\r\n  }, 3000)\r\n}\r\n\r\nfunction myCallBack() {\r\n  console.log('2. The long time process ended')\r\n}\r\n\r\nslowRequest(myCallBack)\r\nconsole.log('3. Another short process')\r\n// 1. A long time process started\r\n// 3. Another short process\r\n// 2. The long time process ended\n</code></pre>\n<h2>1.2. JavaScript Runtime</h2>\n<p>The environment that helps JavaScript being asynchronous</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 562px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/92dc36129fa4b36c6b7340ac1a10fb79/9f2bf/event_loop.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 69.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwACBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB7hrnCc1P/8QAFxABAQEBAAAAAAAAAAAAAAAAAQIAIP/aAAgBAQABBQLVSBS8f//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwGNj//EABgRAAIDAAAAAAAAAAAAAAAAAAABAhFR/9oACAECAQE/AZMp6f/EABgQAAIDAAAAAAAAAAAAAAAAAAABICEx/9oACAEBAAY/AikZD//EABcQAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQEAAT8hXsQ7R3cyWrxzJb//2gAMAwEAAgADAAAAEHMv/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAFREf/aAAgBAwEBPxCsHA//xAAWEQEBAQAAAAAAAAAAAAAAAAARAAH/2gAIAQIBAT8QDRGyn//EABgQAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAEBAAE/EJRUDcOfNdrPOtbrPHndDJteBBBex5bnf//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"event loop\" title=\"\" src=\"/TIL/static/92dc36129fa4b36c6b7340ac1a10fb79/9f2bf/event_loop.jpg\" srcset=\"/TIL/static/92dc36129fa4b36c6b7340ac1a10fb79/e07e9/event_loop.jpg 200w,\n/TIL/static/92dc36129fa4b36c6b7340ac1a10fb79/066f9/event_loop.jpg 400w,\n/TIL/static/92dc36129fa4b36c6b7340ac1a10fb79/9f2bf/event_loop.jpg 562w\" sizes=\"(max-width: 562px) 100vw, 562px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<ol>\n<li>All tasks are processed after entering the <strong>Call Stack</strong>.</li>\n<li>If a long-lasting task enters the stack, it's sent to the <strong>Web API</strong> and processed separately.</li>\n<li>Tasks that have been processed in Web API are sequentially entered into the <strong>Task Queue</strong>.</li>\n<li>When the <strong>Event Loop</strong> detects that the stack is empty, it sends the oldest task in the queue to the stack.</li>\n</ol>\n<hr>\n<h1>2. Axios</h1>\n<p><strong>The library for asynchrnous HTTP communciation.</strong> It can be installed with npm in node.js, and can be used with CDN in browser.</p>\n<h2>2.1. The Structure of Axios</h2>\n<pre><code class=\"language-html\">&#x3C;script src=\"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js\">&#x3C;/script>\r\n  &#x3C;script>\r\n    axios.get('URL')\r\n      .then(callback in case of success)\r\n      .catch(callback in case of failure)\n</code></pre>\n<pre><code class=\"language-html\">&#x3C;button>Cat&#x3C;/button>&#x3C;/button>\r\n  &#x3C;script src=\"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js\">&#x3C;/script>\r\n  &#x3C;script>\r\n    const catImageSearchURL = 'https://api.thecatapi.com/v1/images/search'\r\n    const btn = document.querySelector('button')\r\n\r\n    btn.addEventListener('click', function () {\r\n    //   axios.get(catImageSearchURL)\r\n      axios({\r\n        method: 'get',\r\n        url: catImageSearchURL\r\n      })\r\n        .then((response) => {\r\n          imgElem = document.createElement('img')\r\n          imgElem.setAttribute('src', response.data[0].url)\r\n          document.body.appendChild(imgElem)\r\n        })\r\n        .catch((error) => {\r\n          console.log('Fail!')\r\n        })\r\n        console.log('Success!')\r\n    })\r\n    // Success!\r\n    // response object\r\n\r\n    // axios library works asynchronously\r\n  &#x3C;/script>\n</code></pre>\n<h2>2.2. Promise</h2>\n<p><strong>Promise is the object for giving order to asynchronous process. (chaining)</strong></p>\n<ul>\n<li><strong>methods</strong>\n<ul>\n<li><code>then(onFulfilled)</code>\n<ul>\n<li>Runs the <code>onFulfilled</code> function if the Promise is <strong>fulfilled</strong></li>\n<li><code>onFulfilled</code> has one parameter, the fulfillment value.</li>\n<li>Returns a promise object</li>\n</ul>\n</li>\n<li><code>catch(onReject)</code>\n<ul>\n<li>Runs the <code>onReject</code> function if the Promise is <strong>rejected</strong></li>\n<li><code>onReject</code> function has one parameter: the rejection reason.</li>\n<li>Returns a promise object</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-javascript\">work1()\r\n  .then((result1) => {\r\n    // work 2\r\n    return result2\r\n  })\r\n  .then((result2) => {\r\n    // work 3\r\n    return result3\r\n  })\r\n  .catch((error) => {\r\n    // error handling\r\n  })\n</code></pre>\n<h2>2.2. Promise and Await</h2>\n<p><a href=\"Promise_Await.md\">Promise &#x26; Await를 활용한 4가지 비동기 함수 처리방법.md</a></p>\n<hr>\n<h1>3. AJAX</h1>\n<h2>3.1. AJAX</h2>\n<p>AJAX stands for Asynchronous JavaScript And XML. In a nutshell, it is the use of the <strong>XMLHttpRequest object to communicate with servers</strong>. It can send and receive information in various formats, <strong>including JSON, XML, HTML, and text files.</strong></p>\n<h2>3.2. data-* attribute</h2>\n<p><code>data-*</code>attribute make data can be exchanged between HTML and DOM.</p>\n<pre><code class=\"language-html\">&#x3C;div data-my-id=\"my-data\">&#x3C;/div>\r\n&#x3C;script>\r\n  const myId = event.target.dataset.myId\r\n&#x3C;/script>\n</code></pre>\n<h2>3.3. Example with Django</h2>\n<p><a href=\"../Django/08_Django_Many_to_Many.md\">기존 Django Template and View</a></p>\n<p>csrf-token is in the hidden input tag which name is \"csrfmiddlewaretoken\"</p>\n<h3>3.3.1. Follow</h3>\n<pre><code class=\"language-html\">&#x3C;div>\r\n  팔로워 : &#x3C;span id=\"followers-count\">{{ person.followers.all|length }}&#x3C;/span> /\r\n  팔로잉 : &#x3C;span id=\"followings-count\">{{ person.followings.all|length }}&#x3C;/span>\r\n&#x3C;/div>\r\n&#x3C;div>\r\n  &#x3C;form id=\"follow-form\" data-user-id=\"{{ person.pk }}\">\r\n    {% csrf_token %} {% if request.user in person.followers.all %}\r\n    &#x3C;input type=\"submit\" value=\"언팔로우\" />\r\n    {% else %}\r\n    &#x3C;input type=\"submit\" value=\"팔로우\" />\r\n    {% endif %}\r\n  &#x3C;/form>\r\n  &#x3C;div>\r\n    &#x3C;script src=\"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js\">&#x3C;/script>\r\n    &#x3C;script>\r\n      const form = document.querySelector('#follow-form')\r\n      const csrftoken = document.querySelector(\r\n        '[name=csrfmiddlewaretoken]'\r\n      ).value\r\n\r\n      form.addEventListener('submit', function (event) {\r\n        event.preventDefault()\r\n\r\n        const userId = event.target.dataset.userId\r\n\r\n        axios({\r\n          method: 'post',\r\n          url: `/accounts/${userId}/follow/`,\r\n          headers: { 'X-CSRFToken': csrftoken },\r\n        })\r\n          .then((response) => {\r\n            const isFollowed = response.data.is_followed\r\n            const followBtn = document.querySelector(\r\n              '#follow-form > input[type=submit]'\r\n            )\r\n            if (isFollowed === true) {\r\n              followBtn.value = '언팔로우'\r\n            } else {\r\n              followBtn.value = '팔로우'\r\n            }\r\n\r\n            // 팔로우, 팔로워 인원 수\r\n            const followersCountTag = document.querySelector('#followers-count')\r\n            const followingsCountTag =\r\n              document.querySelector('#followings-count')\r\n            const followersCount = response.data.followers_count\r\n            const followingsCount = response.data.followings_count\r\n            followersCountTag.innerText = followersCount\r\n            followingsCountTag.innerText = followingsCount\r\n          })\r\n          .catch((error) => {\r\n            console.log(error.response)\r\n          })\r\n      })\r\n    &#x3C;/script>\r\n  &#x3C;/div>\r\n&#x3C;/div>\n</code></pre>\n<pre><code class=\"language-python\">@require_POST\r\ndef follow(request, user_pk):\r\n    if request.user.is_authenticated:\r\n        User = get_user_model()\r\n        me = request.user\r\n        you = User.objects.get(pk=user_pk)\r\n        if me != you:\r\n            if you.followers.filter(pk=me.pk).exists():\r\n                you.followers.remove(me)\r\n                is_followed = False\r\n            else:\r\n                you.followers.add(me)\r\n                is_followed = True\r\n            context = {\r\n                'is_followed': is_followed,\r\n                'followers_count': you.followers.count(),\r\n                'followings_count': you.followings.count(),\r\n            }\r\n            return JsonResponse(context)\r\n        return redirect('accounts:profile', you.username)\r\n    return redirect('accounts:login')\n</code></pre>\n<h3>3.3.2. Like</h3>\n<pre><code class=\"language-html\">{% for article in articles %}\r\n&#x3C;p>\r\n  &#x3C;b\r\n    >작성자 :\r\n    &#x3C;a href=\"{% url 'accounts:profile' article.user %}\"\r\n      >{{ article.user }}&#x3C;/a\r\n    >&#x3C;/b\r\n  >\r\n&#x3C;/p>\r\n&#x3C;p>글 번호 : {{ article.pk }}&#x3C;/p>\r\n&#x3C;p>제목 : {{ article.title }}&#x3C;/p>\r\n&#x3C;p>내용 : {{ article.content }}&#x3C;/p>\r\n&#x3C;div>\r\n  &#x3C;form class=\"like-forms\" data-article-id=\"{{ article.pk }}\">\r\n    {% csrf_token %} {% if request.user in article.like_users.all %}\r\n    &#x3C;input type=\"submit\" value=\"좋아요 취소\" id=\"like-{{ article.pk }}\" />\r\n    {% else %}\r\n    &#x3C;input type=\"submit\" value=\"좋아요\" id=\"like-{{ article.pk }}\" />\r\n    {% endif %}\r\n  &#x3C;/form>\r\n&#x3C;/div>\r\n&#x3C;a href=\"{% url 'articles:detail' article.pk %}\">상세 페이지&#x3C;/a>\r\n&#x3C;hr />\r\n{% endfor %}\r\n\r\n&#x3C;script src=\"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js\">&#x3C;/script>\r\n&#x3C;script>\r\n  const forms = document.querySelectorAll('.like-forms')\r\n  const csrftoken = document.querySelector(\r\n    'input[name=csrfmiddlewaretoken]'\r\n  ).value\r\n\r\n  forms.forEach((form) => {\r\n    form.addEventListener('submit', function (event) {\r\n      event.preventDefault()\r\n\r\n      const articleId = event.target.dataset.articleId\r\n\r\n      axios({\r\n        method: 'post',\r\n        url: `http://127.0.0.1:8000/articles/${articleId}/likes/`,\r\n        headers: { 'X-CSRFToken': csrftoken },\r\n      })\r\n        .then((response) => {\r\n          const isLiked = response.data.is_liked\r\n          const likeBtn = document.querySelector(`#like-${articleId}`)\r\n\r\n          if (isLiked === true) {\r\n            likeBtn.value = '좋아요 취소'\r\n          } else {\r\n            likeBtn.value = '좋아요'\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.log(error.response)\r\n        })\r\n    })\r\n  })\r\n&#x3C;/script>\n</code></pre>\n<pre><code class=\"language-python\">@require_POST\r\ndef likes(request, article_pk):\r\n    if request.user.is_authenticated:\r\n        article = Article.objects.get(pk=article_pk)\r\n\r\n        if article.like_users.filter(pk=request.user.pk).exists():\r\n            article.like_users.remove(request.user)\r\n            is_liked = False\r\n        else:\r\n            article.like_users.add(request.user)\r\n            is_liked = True\r\n        context = {\r\n            'is_liked': is_liked,\r\n        }\r\n        return JsonResponse(context)\r\n    return redirect('accounts:login')\n</code></pre>"}},"pageContext":{"pagePath":"posts/JavaScript/03_JavaScript_Asynchronous.md","id":"8f8aefed-d02a-5b7a-8a11-75e5d376c5b2","parent":{"id":"681000fc-0500-578a-aca5-29286bfaea3a","name":"03_JavaScript_Asynchronous","relativePath":"JavaScript/03_JavaScript_Asynchronous.md"}}},"staticQueryHashes":["1274812890","3935499650","82772122"],"slicesMap":{}}