{"componentChunkName":"component---src-templates-post-index-tsx","path":"/posts/DevOps/Kubernetes/k3s_6_cert_manager/","result":{"data":{"markdownRemark":{"id":"6f01b89a-ec71-5dfa-b6a3-8bf60f330a93","html":"<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; margin-bottom: 20px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/TIL/static/830c1399665218f03c26d1757fa48d67/2bef9/architecture-cert-manager.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 70.28571428571428%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVR42n2UXY7bMAyEc/8j9CC9QF8X7Xv70KJYZJMadvwjifqh+BWS0yRYbCpgAJseDWZI0AfAeHdqrSzLQizKEKwTaomkGKnliFnkybHD7akWLAdMM5Yj0S2UGPBBQDNZNkKrhXPnUTKUdIem7u1wt6XY+hvWXyATVS6YTBAnLIwQJqofUTeBXDqn1e4YW7QHQavgT1gZeqQsKyEsVIsYGUioBrRGTAM1uV67Ia/d1IOggsyAdkK7pNmxpsDb9bKqAIU0npDXnzvXmmC+C6YUcc5RNVO2gaoenzZe/oxssnZ3XgNYZIsDqwyk5NASKDXi44rWAHnbBUsppJSuDqfuJKnw9dwEHaVs5Ibsu2AoF0oT624TWYVqTyNfbj1pfTRLhDTh80TJgawbWj0SPCK+97dWwYh3h88EfZQu2MjVpAvOctpdBt/R3Lno0CofC9o1spPIp88zs5Or27T3TB1qgZx30Jy17/w3ciaXxMsPh+R9gm0wWoRLOLLEgZjaQITSWpJdT/BxZD+Cuo6+Xm26/X2DFrs4arvY675Di8MaJ87vBNvG6r5CtSTejq/4dQQrWM3Q1m44M8s+5baO//g3XFfPHiT7iVn58u07wzTf68sCpzNn2wg1Pfs51L9sTklKW6cUCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/TIL/static/830c1399665218f03c26d1757fa48d67/c54d4/architecture-cert-manager.webp 175w,\n/TIL/static/830c1399665218f03c26d1757fa48d67/a3432/architecture-cert-manager.webp 350w,\n/TIL/static/830c1399665218f03c26d1757fa48d67/426ac/architecture-cert-manager.webp 700w,\n/TIL/static/830c1399665218f03c26d1757fa48d67/a9a89/architecture-cert-manager.webp 1024w\" sizes=\"(max-width: 700px) 100vw, 700px\" type=\"image/webp\">\n          <source srcset=\"/TIL/static/830c1399665218f03c26d1757fa48d67/4edbd/architecture-cert-manager.png 175w,\n/TIL/static/830c1399665218f03c26d1757fa48d67/13ae7/architecture-cert-manager.png 350w,\n/TIL/static/830c1399665218f03c26d1757fa48d67/8c557/architecture-cert-manager.png 700w,\n/TIL/static/830c1399665218f03c26d1757fa48d67/2bef9/architecture-cert-manager.png 1024w\" sizes=\"(max-width: 700px) 100vw, 700px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/TIL/static/830c1399665218f03c26d1757fa48d67/8c557/architecture-cert-manager.png\" alt=\"프로젝트 아키텍쳐 구상도\" title=\"\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span>\n<h1 id=\"1-cert-manager\" style=\"position:relative;\"><a href=\"#1-cert-manager\" aria-label=\"1 cert manager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Cert Manager</h1>\n<p>Cert Manager는 쿠버네티스에서 SSL/TLS 인증서를 관리하기 위한 오픈 소스 도구이다. Let's Encrypt와 같은 인증 기관을 사용하여 인증서를 발급하고 갱신하는 작업을 자동화한다. 개인적으로 Certbot의 쿠버네티스 클러스터 버전이라고 생각한다.</p>\n<p>아래 명령어로 Cert Manager 컴포넌트를 설치하고 실행할 수 있다.</p>\n<pre><code class=\"language-bash\"># 공식문서의 최신 명령어를 따를 것을 권장\nkubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.3/cert-manager.yaml\n</code></pre>\n<p>Cert Manager 컴포넌트는 아래처럼 총 3개의 파드를 띄운다.</p>\n<pre><code class=\"language-bash\"># Cert Manager 관련 파드 확인\n$ kubectl get pods --namespace cert-manager\n\nNAME                                       READY   STATUS    RESTARTS   AGE\ncert-manager-5c6866597-zw7kh               1/1     Running   0          2m\ncert-manager-cainjector-577f6d9fd7-tr77l   1/1     Running   0          2m\ncert-manager-webhook-787858fcdb-nlzsq      1/1     Running   0          2m\n</code></pre>\n<h1 id=\"2-cluster-issuer-등록\" style=\"position:relative;\"><a href=\"#2-cluster-issuer-%EB%93%B1%EB%A1%9D\" aria-label=\"2 cluster issuer 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Cluster Issuer 등록</h1>\n<p><a href=\"https://cert-manager.io/docs/concepts/issuer/\">Cert Manager 공식문서</a>를 보면 Isseur와 Cluster Issuer는 모두 인증서를 생성할 수 있는 인증 기관(CA)을 나타내는 Kubernetes 리소스이다. Issuer는 특정 네임스페이스 내에서만 사용 가능하고, Cluster Issuer는 클러스터 전체에 적용되는 인증서를 발급한다. 우리는 Let's Encrypt를 인증기관으로 지정하는 Cluster Issuer를 생성했다.</p>\n<pre><code class=\"language-yml\"># cluster-issuer.yaml\n\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: { 클러스터 이슈어 이름 } # 원하는 대로 지정\n  namespace: default\nspec:\n  acme:\n    server: https://acme-v02.api.letsencrypt.org/directory # Let's Encrypt 인증기관\n    email: { 이메일 등록 } # 유효한 이메일 주소 입력\n    privateKeySecretRef:\n      name: letsencrypt\n    solvers:\n      - selector: {}\n        http01:\n          ingress:\n            class: traefik\n</code></pre>\n<pre><code class=\"language-bash\"># Cluster Issuer 등록\nkubectl apply -f cluster-issuer.yaml\n</code></pre>\n<pre><code class=\"language-bash\"># 등록된 Cluster Issuer 확인\nkubectl get ClusterIssuer -A\n\n# 특정 Cluster Issuer 상세정보 조회\nkubectl describe clusterissuer { 클러스터 이슈어 이름 }\n</code></pre>\n<h1 id=\"3-traefik-ingress-적용\" style=\"position:relative;\"><a href=\"#3-traefik-ingress-%EC%A0%81%EC%9A%A9\" aria-label=\"3 traefik ingress 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Traefik Ingress 적용</h1>\n<p>등록한 Cluster Issuer를 바로 Traefik 인그레스 설정에 적용할 수 있다. 다음과 같이 <code>annotations</code>과 <code>tls</code> 항목을 입력해서 TLS 인증서를 발급받고, HTTPS 연결을 활성화할 수 있다.</p>\n<pre><code class=\"language-yml\">apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: myingress\n  annotations:\n    cert-manager.io/cluster-issuer: { 클러스터 이슈어 이름 } # 위의 2번 항목에서 등록한 이름과 일치\n    kubernetes.io/ingress.class: traefik\nspec:\n  tls:\n    - secretName: { TLS 인증서 이름 } # 원하는대로 지정\n      hosts:\n        - { 도메인 네임 }\n  rules:\n    - host: thegallery.site\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: react-svc\n                port:\n                  number: 80\n          - path: /api\n            pathType: Prefix\n            backend:\n              service:\n                name: gateway-svc\n                port:\n                  number: 8000\n</code></pre>\n<h1 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h1>\n<ul>\n<li><a href=\"https://cert-manager.io/docs/installation/kubectl/#steps\">Cert Manager : \"Installation\"</a></li>\n<li><a href=\"ttps://cert-manager.io/docs/concepts/issuer/\">Cert Manager : \"Issuer\"</a></li>\n<li><a href=\"https://levelup.gitconnected.com/easy-steps-to-install-k3s-with-ssl-certificate-by-traefik-cert-manager-and-lets-encrypt-d74947fe7a8\">Albert Colom : \"Easy steps to install K3s with SSL certificate by traefik, cert manager and Let’s Encrypt\"</a></li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#1-cert-manager\">1. Cert Manager</a></li>\n<li><a href=\"#2-cluster-issuer-%EB%93%B1%EB%A1%9D\">2. Cluster Issuer 등록</a></li>\n<li><a href=\"#3-traefik-ingress-%EC%A0%81%EC%9A%A9\">3. Traefik Ingress 적용</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>","frontmatter":{"title":"k3s 배포하기 (6) : Cert Manager 등록","createdAt":"2024-01-23","updatedAt":"2024-01-23","tags":["kubernetes","k3s","AWS","lightsail","DevOps","HTTPS","SSL/TLS","Cert Manager"],"description":"AWS 인스턴스에 k3s 단일 노드 클러스터를 구축해본다. Cert Manager를 이용해서 쿠버네티스 클러스터의 SSL 인증서를 관리하고, Traefik 인그레스에 등록해보자","reference":null}},"allMarkdownRemark":{"nodes":[{"id":"353ab996-d3e6-5556-8c06-077b7b2f6370","excerpt":"1. 프로젝트 개요 백엔드 개발자 친구와 함께 쿠버네티스를 연습하기 위한 토이프로젝트를 만들었다. 명색이 쿠버네티스 프로젝트인데 MSA를 안할 수 없었다. 백엔드가 MSA로 바쁜데, 프론트가 가만히 있을 수 없어 Three.js…","parent":{"id":"9922ca6f-2e24-5b46-af05-3d732bdc680a","name":"k3s_1_intro","relativePath":"DevOps/Kubernetes/k3s_1_intro.md"},"frontmatter":{"title":"k3s 배포하기 (1) : 프로젝트 개요 & 사전 준비","createdAt":"2024-01-21","updatedAt":"2024-01-21"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_1_intro/"}},{"id":"8d4891d2-35c4-5d9e-ba8b-cbd3586aa466","excerpt":"프론트는 너무 간단하다. Next.js같은 풀스텍 프레임워크를 사용하면 좀 더 흥미로울 것 같다. 1. 도커 이미지 리액트 프로젝트를 빌드하면 정적 파일이 생성된다. 이러한 정적 컨텐츠를 서비스하기 위해서는 웹서버가 필요하다. 그래서 Nginx…","parent":{"id":"78f25f94-3f4b-51ed-8127-3ba754a426e0","name":"k3s_2_front","relativePath":"DevOps/Kubernetes/k3s_2_front.md"},"frontmatter":{"title":"k3s 배포하기 (2) : 프론트(React) 배포","createdAt":"2024-01-21","updatedAt":"2024-01-21"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_2_front/"}},{"id":"4fc2f125-d6bf-558f-a3ac-450a8111a5aa","excerpt":"본래 DB의 아이디와 패스워드는 쿠버네티스에서 Secret으로 관리하는 것을 권장한다. Secret 생성과 적용은 이후 포스팅에서 따로 다룰 예정이다. 1. PV, PVC 쿠버네티스에서는 파드가 죽으면 알아서 다시 띄워준다. 그런데 MySQL…","parent":{"id":"497e574b-50c4-5789-b252-f5e123645d29","name":"k3s_3_mysql","relativePath":"DevOps/Kubernetes/k3s_3_mysql.md"},"frontmatter":{"title":"k3s 배포하기 (3) : 데이터베이스(MySQL) 배포","createdAt":"2024-01-22","updatedAt":"2024-01-22"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_3_mysql/"}},{"id":"105f9b57-232d-5894-b19b-9530e548ea7a","excerpt":"본래 DB의 아이디와 패스워드는 쿠버네티스에서 Secret으로 관리하는 것을 권장한다. Secret 생성과 적용은 이후 포스팅에서 따로 다룰 예정이다. 1. MSA 구조 백엔드는 MSA 구조로 설계되어 총 3개의 Spring Boot…","parent":{"id":"fc9e8efe-87a2-5ae4-9522-a7be3b623338","name":"k3s_4_back","relativePath":"DevOps/Kubernetes/k3s_4_back.md"},"frontmatter":{"title":"k3s 배포하기 (4) : 백엔드(Redis, Spring, Kafka) 배포","createdAt":"2024-01-22","updatedAt":"2024-01-22"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_4_back/"}},{"id":"b074c93c-6fee-597f-84a0-4ae2ca498c4e","excerpt":"1. 인그레스 삽질기⚒️ 이 항목은 k3s를 사용할 경우 참고하지 않아도 되는 삽질기입니다. 우리는 k3s…","parent":{"id":"cf6e57cc-27bd-5a23-a936-4c1be07c330f","name":"k3s_5_ingress","relativePath":"DevOps/Kubernetes/k3s_5_ingress.md"},"frontmatter":{"title":"k3s 배포하기 (5) : Traefik 인그레스 설정","createdAt":"2024-01-23","updatedAt":"2024-01-23"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_5_ingress/"}},{"id":"6f01b89a-ec71-5dfa-b6a3-8bf60f330a93","excerpt":"1. Cert Manager Cert Manager는 쿠버네티스에서 SSL/TLS 인증서를 관리하기 위한 오픈 소스 도구이다. Let's Encrypt와 같은 인증 기관을 사용하여 인증서를 발급하고 갱신하는 작업을 자동화한다. 개인적으로 Certbot…","parent":{"id":"fee655a1-4c88-55d5-b977-a0a4688b4e3b","name":"k3s_6_cert_manager","relativePath":"DevOps/Kubernetes/k3s_6_cert_manager.md"},"frontmatter":{"title":"k3s 배포하기 (6) : Cert Manager 등록","createdAt":"2024-01-23","updatedAt":"2024-01-23"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_6_cert_manager/"}},{"id":"df9bb52a-2328-5c01-a25b-870413c2fc5a","excerpt":"1. Secret 이란? Secret은 쿠버네티스 클러스터에서 비밀번호와 같은 민감한 데이터를 관리하기 위한 객체이다. 쿠버네티스 클러스터 내에서 마치 환경변수처럼 동작하기 때문에, 여러 Pod에서 독립적으로 값을 참조할 수 있다. 값을 yml…","parent":{"id":"176dffb2-6e59-5b17-aa12-1724f04ed480","name":"k3s_7_secret","relativePath":"DevOps/Kubernetes/k3s_7_secret.md"},"frontmatter":{"title":"k3s 배포하기 (7) : Secret 등록","createdAt":"2024-01-28","updatedAt":"2024-01-28"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_7_secret/"}}]}},"pageContext":{"pagePath":"/posts/DevOps/Kubernetes/k3s_6_cert_manager/","siblingPostsPathRegex":"/^(?!.*README).*DevOps\\/Kubernetes\\/.*$/","relativeDirectory":"Kubernetes","id":"6f01b89a-ec71-5dfa-b6a3-8bf60f330a93","parent":{"id":"fee655a1-4c88-55d5-b977-a0a4688b4e3b","name":"k3s_6_cert_manager","relativePath":"DevOps/Kubernetes/k3s_6_cert_manager.md"},"fields":{"slug":"/posts/DevOps/Kubernetes/k3s_6_cert_manager/"}}},"staticQueryHashes":["24302420","4059933791"],"slicesMap":{}}